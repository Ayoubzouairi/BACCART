<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙØ±Øµ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø© - ØªØ­Ù„ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù… (Ù…Ø¹ Ø±ÙØ¹ ØµÙˆØ± Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª)</title>
    <style>
        /* (existing CSS kept mostly unchanged; shortened here for brevity) */
        * { box-sizing: border-box; margin:0; padding:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
        body { background: linear-gradient(135deg,#1e3c72 0%,#2a5298 100%); color:#333; padding:20px; min-height:100vh; transition: all .3s;}
        body.night-mode { background: linear-gradient(135deg,#0f1a2e 0%,#1a2b4e 100%); color:#e0e0e0; }
        .container{ max-width:1200px; margin:0 auto;}
        header{ text-align:center; margin-bottom:30px; color:white; padding:20px; background:rgba(0,0,0,0.2); border-radius:15px;}
        .main-content{ display:flex; flex-wrap:wrap; gap:20px; margin-bottom:30px; }
        .input-section, .result-section{ background:white; padding:25px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
        .input-section{ flex:1; min-width:300px;}
        .result-section{ flex:2; min-width:300px;}
        .team-input{ margin-bottom:20px;}
        .team-name{ width:100%; padding:12px; margin-bottom:15px; border:2px solid #ddd; border-radius:8px; font-size:16px;}
        .image-upload-row{ display:flex; gap:10px; align-items:center; margin-top:10px; flex-wrap:wrap;}
        .image-preview{ width:120px; height:80px; border-radius:8px; object-fit:cover; border:1px solid #ddd; }
        .small-btn{ padding:8px 10px; border-radius:8px; cursor:pointer; border:none; background:#3182ce; color:white;}
        .notice{ font-size:0.9rem; color:#444; margin-top:8px;}
        @media(max-width:768px){ .main-content{ flex-direction:column; } .image-preview{ width:80px; height:60px; } }
    </style>
</head>
<body>
    <button class="theme-toggle" id="theme-toggle">ğŸŒ™</button>
    <div class="container">
        <header>
            <h1>ğŸ¦¾ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙØ±Øµ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø© - ØªØ­Ù„ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù…</h1>
            <p class="subtitle">Ø§Ù„Ø¢Ù† Ù…Ø¹ Ø±ÙØ¹ ØµÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØµØ§Ø¨ÙŠÙ†/Ø§Ù„Ù…Ø´ÙƒÙˆÙƒ ÙÙŠ Ù„Ø¹Ø¨Ù‡Ù…</p>
        </header>

        <div class="main-content">
            <div class="input-section">
                <h2>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>

                <div class="team-input">
                    <h3>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</h3>
                    <input type="text" class="team-name" id="team1-name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„">

                    <div class="image-upload-row">
                        <label for="team1-image" class="small-btn">Ø±ÙØ¹ ØµÙˆØ±Ø© Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</label>
                        <input id="team1-image" type="file" accept="image/*" style="display:none">
                        <img id="team1-preview" class="image-preview" src="" alt="Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©" style="display:none">
                        <button class="small-btn" id="team1-analyze-btn">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© (AI)</button>
                    </div>
                    <div id="team1-injuries" class="notice">Ù„Ù… ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„ Ø¨Ø¹Ø¯.</div>

                    <h4>Ù†ØªØ§Ø¦Ø¬ Ø¢Ø®Ø± 5 Ù…Ø¨Ø§Ø±ÙŠØ§Øª:</h4>
                    <div id="team1-results"></div>

                    <h4>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:</h4>
                    <div id="team1-goals"></div>

                    <button class="reset-btn" onclick="resetTeamData('team1')">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</button>
                </div>

                <div class="team-input">
                    <h3>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</h3>
                    <input type="text" class="team-name" id="team2-name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ">

                    <div class="image-upload-row">
                        <label for="team2-image" class="small-btn">Ø±ÙØ¹ ØµÙˆØ±Ø© Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
                        <input id="team2-image" type="file" accept="image/*" style="display:none">
                        <img id="team2-preview" class="image-preview" src="" alt="Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©" style="display:none">
                        <button class="small-btn" id="team2-analyze-btn">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© (AI)</button>
                    </div>
                    <div id="team2-injuries" class="notice">Ù„Ù… ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¨Ø¹Ø¯.</div>

                    <h4>Ù†ØªØ§Ø¦Ø¬ Ø¢Ø®Ø± 5 Ù…Ø¨Ø§Ø±ÙŠØ§Øª:</h4>
                    <div id="team2-results"></div>

                    <h4>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:</h4>
                    <div id="team2-goals"></div>

                    <button class="reset-btn" onclick="resetTeamData('team2')">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
                </div>

                <button class="reset-btn" onclick="resetAllData()" style="background:#ff9800;">ğŸ—‘ï¸ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>

                <button class="calculate-btn" id="calculate-btn">ğŸ§® Ø§Ø­Ø³Ø¨ Ø§Ù„ÙØ±Øµ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø©</button>

                <div style="margin-top:12px;">
                    <label class="small-btn" id="toggle-sim">ÙˆØ¶Ø¹ Ù…Ø­Ù„ÙŠ (Ù…Ø­Ø§ÙƒØ§Ø©) : ØªØ´ØºÙŠÙ„</label>
                    <div class="notice">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù‡Ùˆ Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¯ÙˆÙ† Ø³ÙŠØ±ÙØ± AI Ø­Ù‚ÙŠÙ‚ÙŠ. Ù„ØªØ´ØºÙŠÙ„ AI Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù‚Ù… Ø¨ØªØ´ØºÙŠÙ„ Ø³ÙŠØ±ÙØ± Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙŠ README.</div>
                </div>
            </div>

            <div class="result-section">
                <h2>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h2>
                <div id="results-container">
                    <p style="text-align:center; padding:20px;">Ø³ÙŠØ¸Ù‡Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ±Øµ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø© Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                </div>

                <div class="team-stats" id="team-stats" style="display:none;"></div>
                <div class="goals-prediction" id="goals-prediction" style="display:none;"></div>
                <div class="match-history" id="match-history" style="display:none;">
                    <h3>Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</h3>
                    <table class="history-table">
                        <thead>
                            <tr><th>Ø§Ù„ÙØ±ÙŠÙ‚</th><th>Ø¢Ø®Ø± 5 Ù…Ø¨Ø§Ø±ÙŠØ§Øª</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th><th>Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</th></tr>
                        </thead>
                        <tbody id="history-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <footer>
            <p>ğŸ¦¾ ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø© Ù„ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª â€” Ø§Ù„Ø¢Ù† Ù…Ø¹ ØªÙƒØ§Ù…Ù„ ØµÙˆØ± Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª</p>
        </footer>
    </div>

<script>
/* ====== ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ÙˆØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ) ====== */
let isNightMode = false;
document.addEventListener('DOMContentLoaded', function() {
    initializeTeamResults('team1-results', ['W','W','D','W','L']);
    initializeTeamResults('team2-results', ['W','D','L','W','W']);
    initializeGoalsInput('team1-goals', [2,3,1,2,0]);
    initializeGoalsInput('team2-goals', [2,1,0,3,2]);
    document.getElementById('calculate-btn').addEventListener('click', calculateDoubleChance);
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    loadThemePreference();

    // image upload handlers
    document.getElementById('team1-image').addEventListener('change', e => handleImagePreview(e, 'team1'));
    document.getElementById('team2-image').addEventListener('change', e => handleImagePreview(e, 'team2'));
    document.getElementById('team1-analyze-btn').addEventListener('click', () => analyzeImageForTeam('team1'));
    document.getElementById('team2-analyze-btn').addEventListener('click', () => analyzeImageForTeam('team2'));

    // toggle simulation
    const toggleSim = document.getElementById('toggle-sim');
    toggleSim.addEventListener('click', () => {
        simulateMode = !simulateMode;
        toggleSim.textContent = 'ÙˆØ¶Ø¹ Ù…Ø­Ù„ÙŠ (Ù…Ø­Ø§ÙƒØ§Ø©) : ' + (simulateMode ? 'ØªØ´ØºÙŠÙ„' : 'Ø¥ÙŠÙ‚Ø§Ù');
    });
});

// Ø­ÙØ¸ ØªÙØ¶ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹
function toggleTheme() {
    isNightMode = !isNightMode;
    const body = document.body;
    const themeToggle = document.getElementById('theme-toggle');
    if (isNightMode) { body.classList.add('night-mode'); themeToggle.textContent='â˜€ï¸'; }
    else { body.classList.remove('night-mode'); themeToggle.textContent='ğŸŒ™'; }
    localStorage.setItem('nightMode', isNightMode);
}
function loadThemePreference(){ const savedTheme = localStorage.getItem('nightMode'); if(savedTheme==='true'){ isNightMode=true; document.body.classList.add('night-mode'); document.getElementById('theme-toggle').textContent='â˜€ï¸'; } }

/* ====== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ù‚ ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ ====== */
let teamData = { team1:{ name:'', results:[], goals:[], injuries: [] }, team2:{ name:'', results:[], goals:[], injuries: [] } };

/* ====== ÙˆØ¸Ø§Ø¦Ù Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙˆØ§Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ù‡Ø¯Ø§Ù (Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ) ====== */
function resetTeamData(team) {
    if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª ${team==='team1' ? 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„' : 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ'}ØŸ`)) {
        const initialResults = team === 'team1' ? ['W','W','D','W','L'] : ['W','D','L','W','W'];
        const initialGoals = team === 'team1' ? [2,3,1,2,0] : [2,1,0,3,2];
        initializeTeamResults(`${team}-results`, initialResults);
        initializeGoalsInput(`${team}-goals`, initialGoals);
        document.getElementById(`${team}-name`).value = '';
        document.getElementById(`${team}-preview`).style.display = 'none';
        document.getElementById(`${team}-injuries`).textContent = 'Ù„Ù… ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ø¹Ø¯.';
        alert('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
    }
}
function resetAllData(){
    if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡!')){
        initializeTeamResults('team1-results', ['W','W','D','W','L']);
        initializeGoalsInput('team1-goals', [2,3,1,2,0]);
        document.getElementById('team1-name').value='';
        initializeTeamResults('team2-results', ['W','D','L','W','W']);
        initializeGoalsInput('team2-goals', [2,1,0,3,2]);
        document.getElementById('team2-name').value='';
        document.getElementById('results-container').innerHTML = '<p style="text-align:center;padding:20px;">Ø³ÙŠØ¸Ù‡Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ±Øµ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø© Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>';
        document.getElementById('team-stats').style.display='none';
        document.getElementById('goals-prediction').style.display='none';
        document.getElementById('match-history').style.display='none';
        document.getElementById('team1-preview').style.display='none';
        document.getElementById('team2-preview').style.display='none';
        document.getElementById('team1-injuries').textContent='Ù„Ù… ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„ Ø¨Ø¹Ø¯.';
        document.getElementById('team2-injuries').textContent='Ù„Ù… ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¨Ø¹Ø¯.';
        alert('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
    }
}
function initializeTeamResults(containerId, initialResults){
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    for(let i=0;i<5;i++){
        const matchDiv = document.createElement('div');
        matchDiv.className='match-results';
        const matchLabel = document.createElement('span'); matchLabel.textContent = `Ù…Ø¨Ø§Ø±Ø§Ø© ${i+1}:`; matchLabel.style.width='80px'; matchDiv.appendChild(matchLabel);
        const results = ['W','D','L'];
        const resultLabels = {'W':'ÙÙˆØ²','D':'ØªØ¹Ø§Ø¯Ù„','L':'Ø®Ø³Ø§Ø±Ø©'};
        const resultClasses = {'W':'win','D':'draw','L':'lose'};
        results.forEach(result => {
            const btn = document.createElement('button');
            btn.className = `result-btn ${resultClasses[result]}`; btn.textContent = resultLabels[result]; btn.dataset.result = result;
            if(result === initialResults[i]) btn.classList.add('selected');
            btn.addEventListener('click', function(){ this.parentElement.querySelectorAll('.result-btn').forEach(b=>b.classList.remove('selected')); this.classList.add('selected'); });
            matchDiv.appendChild(btn);
        });
        container.appendChild(matchDiv);
    }
}
function initializeGoalsInput(containerId, initialGoals){
    const container = document.getElementById(containerId);
    container.innerHTML='';
    for(let i=0;i<5;i++){
        const goalsDiv = document.createElement('div'); goalsDiv.className='goals-input';
        const matchLabel = document.createElement('span'); matchLabel.textContent=`Ù…Ø¨Ø§Ø±Ø§Ø© ${i+1}:`; matchLabel.style.width='80px'; goalsDiv.appendChild(matchLabel);
        const goalsInput = document.createElement('input'); goalsInput.type='number'; goalsInput.min='0'; goalsInput.value = initialGoals[i]; goalsInput.dataset.match = i+1; goalsDiv.appendChild(goalsInput);
        const goalsText = document.createElement('span'); goalsText.textContent = ' Ù‡Ø¯Ù'; goalsDiv.appendChild(goalsText);
        container.appendChild(goalsDiv);
    }
}
function getTeamResults(containerId){
    const container = document.getElementById(containerId);
    const matches = container.querySelectorAll('.match-results');
    const results = [];
    matches.forEach(match => {
        const selectedBtn = match.querySelector('.result-btn.selected');
        if(selectedBtn) results.push(selectedBtn.dataset.result);
    });
    return results;
}
function getTeamGoals(containerId){
    const container = document.getElementById(containerId);
    const inputs = container.querySelectorAll('input');
    const goals = [];
    inputs.forEach(input => goals.push(parseInt(input.value) || 0));
    return goals;
}

/* ====== Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª (ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„ÙŠØªØ£Ø«Ø± Ø¨Ø¥ØµØ§Ø¨Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†) ====== */
function calculatePoints(results){
    let points = 0;
    results.forEach(result => { if(result==='W') points+=3; else if(result==='D') points+=1; });
    return points;
}
function calculatePredictedGoals(team1Avg, team2Avg){
    const team1Predicted = team1Avg * 0.8; const team2Predicted = team2Avg * 0.8; const totalPredicted = team1Predicted + team2Predicted;
    return { team1:team1Predicted, team2:team2Predicted, total:totalPredicted };
}

function calculateDoubleChance() {
    const team1Name = document.getElementById('team1-name').value || 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„';
    const team2Name = document.getElementById('team2-name').value || 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ';
    const team1Results = getTeamResults('team1-results');
    const team2Results = getTeamResults('team2-results');
    const team1Goals = getTeamGoals('team1-goals');
    const team2Goals = getTeamGoals('team2-goals');

    const team1Points = calculatePoints(team1Results);
    const team2Points = calculatePoints(team2Results);
    const team1AvgGoals = team1Goals.reduce((a,b)=>a+b,0)/team1Goals.length;
    const team2AvgGoals = team2Goals.reduce((a,b)=>a+b,0)/team2Goals.length;

    /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª: ÙƒÙ„ Ù„Ø§Ø¹Ø¨ Ù…ØµØ§Ø¨ Ù…ÙØ¹Ù„Ù† ÙŠÙ‚Ù„Ù„ Ù…Ù† Ù‚ÙˆØ© Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ù†Ø³Ø¨Ø© 0.12 (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)ØŒ Ø­ØªÙ‰ Ø­Ø¯ Ø£Ù‚ØµÙ‰ 0.6 */
    const injuryPenaltyPerPlayer = 0.12;
    const team1Injuries = (teamData.team1.injuries || []).filter(p => p.injured).length;
    const team2Injuries = (teamData.team2.injuries || []).filter(p => p.injured).length;
    const team1Penalty = Math.min(team1Injuries * injuryPenaltyPerPlayer, 0.6);
    const team2Penalty = Math.min(team2Injuries * injuryPenaltyPerPlayer, 0.6);

    const totalPoints = team1Points + team2Points;
    let team1Strength = totalPoints > 0 ? team1Points / totalPoints : 0.5;
    let team2Strength = totalPoints > 0 ? team2Points / totalPoints : 0.5;

    // ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù‚ÙˆØ¨Ø© Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ©
    team1Strength = Math.max(0.05, team1Strength - team1Penalty);
    team2Strength = Math.max(0.05, team2Strength - team2Penalty);

    const team1WinProb = team1Strength * (1 - team2Strength) * 0.8;
    const team2WinProb = team2Strength * (1 - team1Strength) * 0.8;
    const drawProb = 0.2 + (team1Strength * team2Strength * 0.3);
    const totalProb = team1WinProb + team2WinProb + drawProb;
    const normalizedTeam1Win = (team1WinProb / totalProb) * 100;
    const normalizedTeam2Win = (team2WinProb / totalProb) * 100;
    const normalizedDraw = (drawProb / totalProb) * 100;
    const doubleChance1X = normalizedTeam1Win + normalizedDraw;
    const doubleChance12 = normalizedTeam1Win + normalizedTeam2Win;
    const doubleChanceX2 = normalizedDraw + normalizedTeam2Win;
    const predictedGoals = calculatePredictedGoals(team1AvgGoals, team2AvgGoals);

    displayAdvancedResults(
        team1Name, team2Name,
        normalizedTeam1Win, normalizedTeam2Win, normalizedDraw,
        doubleChance1X, doubleChance12, doubleChanceX2,
        team1Results, team2Results, team1Points, team2Points,
        team1Goals, team2Goals, predictedGoals
    );
}

/* ====== Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Ù†ÙØ³ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù…Ø¹ Ø¨Ù‚ÙŠØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„) ====== */
function displayAdvancedResults(team1Name, team2Name, team1Win, team2Win, draw,
                               doubleChance1X, doubleChance12, doubleChanceX2,
                               team1Results, team2Results, team1Points, team2Points,
                               team1Goals, team2Goals, predictedGoals) {
    const resultsContainer = document.getElementById('results-container');
    const matchHistory = document.getElementById('match-history');
    const teamStats = document.getElementById('team-stats');
    const goalsPrediction = document.getElementById('goals-prediction');

    const formatPercent = (v)=> v.toFixed(1)+'%';
    const team1TotalGoals = team1Goals.reduce((a,b)=>a+b,0);
    const team2TotalGoals = team2Goals.reduce((a,b)=>a+b,0);

    // Append injury summary at top
    const injurySummaryHTML = `
        <div class="probability-card">
            <h3>ğŸ©º Ù…Ù„Ø®Øµ Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ©</h3>
            <div style="display:flex; gap:12px; flex-wrap:wrap;">
                <div style="min-width:200px;">
                    <div class="stats-title team1-color">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</div>
                    <div id="injury-team1-list">${(teamData.team1.injuries && teamData.team1.injuries.length>0) ? teamData.team1.injuries.map(p=>p.name+' ('+(p.injured? 'Ù…ØµØ§Ø¨':'Ù…Ø´ÙƒÙˆÙƒ')+')').join('<br>') : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…ØµØ§Ø¨ÙŠÙ† Ù…Ø¤ÙƒØ¯ÙŠÙ†.'}</div>
                </div>
                <div style="min-width:200px;">
                    <div class="stats-title team2-color">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</div>
                    <div id="injury-team2-list">${(teamData.team2.injuries && teamData.team2.injuries.length>0) ? teamData.team2.injuries.map(p=>p.name+' ('+(p.injured? 'Ù…ØµØ§Ø¨':'Ù…Ø´ÙƒÙˆÙƒ')+')').join('<br>') : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…ØµØ§Ø¨ÙŠÙ† Ù…Ø¤ÙƒØ¯ÙŠÙ†.'}</div>
                </div>
            </div>
        </div>
    `;

    let resultsHTML = injurySummaryHTML + `
        <div class="probability-card">
            <h3>ğŸ¯ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
            <div class="probability-item">
                <div class="probability-header">
                    <span class="team1-color">ÙÙˆØ² ${team1Name}</span><span>${formatPercent(team1Win)}</span>
                </div>
                <div class="probability-bar"><div class="probability-fill" style="width:${team1Win}%"></div></div>
            </div>
            <div class="probability-item">
                <div class="probability-header"><span>ØªØ¹Ø§Ø¯Ù„</span><span>${formatPercent(draw)}</span></div>
                <div class="probability-bar"><div class="probability-fill" style="width:${draw}%"></div></div>
            </div>
            <div class="probability-item">
                <div class="probability-header"><span class="team2-color">ÙÙˆØ² ${team2Name}</span><span>${formatPercent(team2Win)}</span></div>
                <div class="probability-bar"><div class="probability-fill" style="width:${team2Win}%"></div></div>
            </div>
        </div>

        <div class="probability-card">
            <h3>ğŸ”„ Ø§Ù„ÙØ±Øµ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø© <span class="accuracy-high">(Ù…ØªØ£Ø«Ø±Ø© Ø¨Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª)</span></h3>
            <div class="probability-item">
                <div class="probability-header"><span>${team1Name} Ø£Ùˆ ØªØ¹Ø§Ø¯Ù„ (1X)</span><span>${formatPercent(doubleChance1X)}</span></div>
                <div class="probability-value">${formatPercent(doubleChance1X)}</div>
                <div class="probability-bar"><div class="probability-fill" style="width:${doubleChance1X}%"></div></div>
            </div>
            <div class="probability-item">
                <div class="probability-header"><span>${team1Name} Ø£Ùˆ ${team2Name} (12)</span><span>${formatPercent(doubleChance12)}</span></div>
                <div class="probability-value">${formatPercent(doubleChance12)}</div>
                <div class="probability-bar"><div class="probability-fill" style="width:${doubleChance12}%"></div></div>
            </div>
            <div class="probability-item">
                <div class="probability-header"><span>ØªØ¹Ø§Ø¯Ù„ Ø£Ùˆ ${team2Name} (X2)</span><span>${formatPercent(doubleChanceX2)}</span></div>
                <div class="probability-value">${formatPercent(doubleChanceX2)}</div>
                <div class="probability-bar"><div class="probability-fill" style="width:${doubleChanceX2}%"></div></div>
            </div>
        </div>
    `;
    resultsContainer.innerHTML = resultsHTML;

    let statsHTML = `
        <div class="stats-card">
            <div class="stats-title team1-color">${team1Name}</div>
            <div class="goals-summary">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: ${team1TotalGoals}</div>
            <div>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: ${(team1TotalGoals/5).toFixed(1)}</div>
            <div>Ø§Ù„Ù†Ù‚Ø§Ø·: ${team1Points}</div>
        </div>
        <div class="stats-card">
            <div class="stats-title team2-color">${team2Name}</div>
            <div class="goals-summary">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: ${team2TotalGoals}</div>
            <div>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: ${(team2TotalGoals/5).toFixed(1)}</div>
            <div>Ø§Ù„Ù†Ù‚Ø§Ø·: ${team2Points}</div>
        </div>
    `;
    teamStats.innerHTML = statsHTML; teamStats.style.display='flex';

    let predictionHTML = `
        <div class="prediction-title">ğŸ¯ ØªÙˆÙ‚Ø¹ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</div>
        <div style="display:flex; justify-content:space-around; text-align:center;">
            <div><div class="team1-color">${team1Name}</div><div class="prediction-value">${predictedGoals.team1.toFixed(1)}</div><div>Ù‡Ø¯Ù Ù…ØªÙˆÙ‚Ø¹</div></div>
            <div><div>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</div><div class="prediction-value">${predictedGoals.total.toFixed(1)}</div><div>Ø£Ù‡Ø¯Ø§Ù Ù…ØªÙˆÙ‚Ø¹Ø©</div></div>
            <div><div class="team2-color">${team2Name}</div><div class="prediction-value">${predictedGoals.team2.toFixed(1)}</div><div>Ù‡Ø¯Ù Ù…ØªÙˆÙ‚Ø¹</div></div>
        </div>
    `;
    goalsPrediction.innerHTML = predictionHTML; goalsPrediction.style.display='block';

    const historyBody = document.getElementById('history-body');
    let historyHTML = '';
    historyHTML += `<tr><td class="team1-color">${team1Name}</td><td>${team1Results.map(r=>getResultSymbol(r)).join(' ')}</td><td>${team1Points}</td><td>${team1Goals.join(' - ')}</td></tr>`;
    historyHTML += `<tr><td class="team2-color">${team2Name}</td><td>${team2Results.map(r=>getResultSymbol(r)).join(' ')}</td><td>${team2Points}</td><td>${team2Goals.join(' - ')}</td></tr>`;
    historyBody.innerHTML = historyHTML; matchHistory.style.display='block';
}
function getResultSymbol(result){ switch(result){ case 'W': return 'âœ…'; case 'D': return 'â–'; case 'L': return 'âŒ'; default: return '?'; }}

/* ====== ÙˆØ¸Ø§Ø¦Ù Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ====== */
/* Ø³Ù„ÙˆÙƒ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:
   - ÙŠØ­Ø§ÙˆÙ„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ endpoint: POST /api/analyze Ù…Ø¹ Ø­Ù‚Ù„ form-data: "team" (team1|team2) Ùˆ "image" (file).
   - Ø§Ù„ØªÙˆÙ‚Ø¹: Ø§Ù„Ø±Ø¯ JSON Ø¨Ø§Ù„Ø´ÙƒÙ„: { players: [ { name: "Player Name", confidence: 0.92, injured: true|false, position: "FW" }, ... ] }
   - Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙˆÙØ± Ø³ÙŠØ±ÙØ±ØŒ ÙŠÙˆØ¬Ø¯ ÙˆØ¶Ø¹ Ù…Ø­Ù„ÙŠ (simulateMode) ÙŠØ¹ÙŠØ¯ Ù†ØªÙŠØ¬Ø© Ù…Ø­Ø§ÙƒØ§Ø©.
*/
let simulateMode = true; // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ (ÙŠÙ…ÙƒÙ† ØªØ¨Ø¯ÙŠÙ„Ù‡ Ø¨Ø§Ù„Ø²Ø±)
async function handleImagePreview(event, team){
    const file = event.target.files[0];
    if(!file) return;
    const preview = document.getElementById(team + '-preview');
    preview.src = URL.createObjectURL(file);
    preview.style.display = 'block';
    // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù ÙÙŠ teamData temporally (File object)
    teamData[team].imageFile = file;
    document.getElementById(team + '-inuries')?.textContent = 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©. Ø§Ø¶ØºØ· "ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© (AI)" Ù„ØªØ­Ù„ÙŠÙ„Ù‡Ø§.';
}

async function analyzeImageForTeam(team){
    const file = teamData[team].imageFile;
    if(!file){ alert('ğŸ“¸ Ù„Ù… ØªÙ‚Ù… Ø¨Ø±ÙØ¹ ØµÙˆØ±Ø© Ù„Ù„ÙØ±ÙŠÙ‚ Ø¨Ø¹Ø¯.'); return; }
    document.getElementById(team + '-inuries').textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...';
    try {
        let result;
        if(simulateMode){
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø³Ø±ÙŠØ¹Ø©: Ù†Ø³ØªØ®Ø±Ø¬ Ø£Ø³Ù…Ø§Ø¡ ÙˆÙ‡Ù…ÙŠØ© Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ù†Ù‚ØªØ±Ø­ Ù„Ø§Ø¹Ø¨ Ù…ØµØ§Ø¨ ÙˆØ§Ø­Ø¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
            result = await simulateAnalyze(file, team);
        } else {
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø³ÙŠØ±ÙØ± Ø®Ø§Ø±Ø¬ÙŠ (ÙŠØ¬Ø¨ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ù…ÙˆØ¶Ø­ ÙÙŠ README)
            const form = new FormData();
            form.append('team', team);
            form.append('image', file, file.name);
            const resp = await fetch('/api/analyze', { method: 'POST', body: form });
            if(!resp.ok) throw new Error('Ù„Ù… ÙŠØªÙˆØµÙ„ Ø¨Ø±Ø¯ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±: ' + resp.statusText);
            result = await resp.json();
        }
        // result.players => ØªØ­Ø¯ÙŠØ« teamData
        teamData[team].injuries = result.players || [];
        // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        document.getElementById(team + '-inuries').innerHTML = (teamData[team].injuries.length>0) ? teamData[team].injuries.map(p=>`${p.name} â€” ${p.injured ? 'Ù…ØµØ§Ø¨' : 'Ù…Ø´ÙƒÙˆÙƒ'} (${Math.round((p.confidence||0)*100)}%)`).join('<br>') : 'Ù„Ø§ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…ØµØ§Ø¨ÙŠÙ† Ù…ÙƒØªØ´ÙÙŠÙ†.';
        // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù†Ø¹ÙŠØ¯ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        calculateDoubleChance();
    } catch(e){
        console.error(e);
        document.getElementById(team + '-injuries').textContent = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„. Ø±Ø§Ø¬Ø¹ README Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£Ùˆ ÙØ¹Ù‘Ù„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©.';
    }
}

// Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© (ÙˆØ¶Ø¹ Ù…Ø­Ù„ÙŠØŒ Ù„Ø§ ÙŠØ­ØªØ§Ø¬ Ø¥Ù†ØªØ±Ù†Øª)
async function simulateAnalyze(file, team){
    // Ù†Ø³ØªØ®Ø¯Ù… Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (Ø¥Ù† ÙˆÙØ¬Ø¯)
    const base = (file.name || 'player').split('.')[0];
    const samplePlayers = [
        {name: base + ' Ø£', confidence: 0.92, injured: Math.random() < 0.5, position: 'FW'},
        {name: base + ' Ø¨', confidence: 0.81, injured: Math.random() < 0.35, position: 'MF'},
        {name: base + ' Ø¬', confidence: 0.73, injured: Math.random() < 0.2, position: 'DF'}
    ];
    // Ù†Ø±Ø¬Ø¹ Ù…Ù† 0 Ø¥Ù„Ù‰ 3 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ø¹ Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ù…Ø®ØªÙ„ÙØ©
    return new Promise(resolve => setTimeout(()=> resolve({ players: samplePlayers.slice(0, 1 + Math.floor(Math.random()*3)) }), 800));
}

/* ====== Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ====== */

</script>
</body>
</html>
