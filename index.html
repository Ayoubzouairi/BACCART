<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AYOUB BACCARAT PATTERN READER</title>
<style>
:root{--gold:#d4af37;--gold-2:#b8871d;--bg-dark:#070606;--card:#0f0e10;--muted:#bfb7a6;--player:#2d7ef7;--banker:#e03b3b;--tie:#28a745;}
*{box-sizing:border-box}
body{font-family:system-ui,sans-serif;margin:0;background:var(--bg-dark);color:#fff;padding:10px;}
.app{max-width:1200px;margin:0 auto}
.top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.logo{font-weight:800;background:var(--gold);color:#000;padding:5px 10px;border-radius:8px;}
.card{background:var(--card);border-radius:8px;padding:10px;margin-bottom:10px;}
.btn{padding:10px;border-radius:6px;border:none;color:white;cursor:pointer;margin:2px;}
.btn.gold{background:var(--gold);color:#000;}
.btn.player{background:var(--player);}
.btn.banker{background:var(--banker);}
.btn.tie{background:var(--tie);}
.camera-view{width:100%;border-radius:6px; background:#000;}
.pattern-grid{display:grid;grid-template-columns: repeat(6, 1fr); gap:4px; margin:10px 0;}
.pattern-cell{width:20px;height:20px;border-radius:3px; display:flex;align-items:center;justify-content:center;font-size:10px; font-weight:bold;}
.pattern-P{background:var(--player);}
.pattern-B{background:var(--banker);}
.pattern-T{background:var(--tie);}
</style>
</head>
<body>
<div class="app">
<div class="top">
  <div class="logo">BACCARAT PATTERN READER</div>
  <button class="btn gold" onclick="resetAll()">RESET</button>
</div>

<div class="card">
  <div style="margin-bottom:10px;">
    <button class="btn gold" onclick="startCamera()">START CAMERA</button>
    <button class="btn" onclick="stopCamera()" style="background:#666;">STOP</button>
  </div>
  <video id="cameraView" class="camera-view" autoplay playsinline style="display:none;"></video>
  <div style="text-align:center; margin:10px 0; font-size:12px; color:var(--muted);">
    ÙˆØ¬Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø§ÙƒØ§Ø±Ø§Øª Ù…Ø¹ Big Road
  </div>
  <button class="btn gold" onclick="analyzePattern()" style="width:100%; display:none;" id="analyzeBtn">ANALYZE PATTERNS</button>
</div>

<div class="card">
  <div style="font-weight:bold; margin-bottom:8px;">ğŸ¯ DETECTED PATTERNS</div>
  <div id="patternResults">
    <div style="text-align:center; color:var(--muted);">No patterns detected yet</div>
  </div>
</div>

<div class="card">
  <div style="font-weight:bold; margin-bottom:8px;">ğŸ“Š BIG ROAD ANALYSIS</div>
  <div class="pattern-grid" id="bigRoadDisplay">
    <!-- Big Road patterns will appear here -->
  </div>
</div>

<div class="card">
  <div style="font-weight:bold; margin-bottom:8px;">ğŸ”® PREDICTION</div>
  <div id="predictionResult" style="text-align:center; padding:15px; background:rgba(212,175,55,0.1); border-radius:6px;">
    Analyze patterns to see prediction
  </div>
</div>

<div class="card">
  <div style="font-weight:bold; margin-bottom:8px;">âš¡ MANUAL CONTROL</div>
  <div style="display:flex; gap:5px;">
    <button class="btn player" onclick="addResult('P')">P</button>
    <button class="btn banker" onclick="addResult('B')">B</button>
    <button class="btn tie" onclick="addResult('T')">T</button>
  </div>
</div>
</div>

<script>
class PatternAnalyzer {
    constructor() {
        this.patterns = [];
        this.bigRoad = [];
        this.lastAnalysis = null;
    }

    // Ù…Ø­Ø§ÙƒØ§Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©
    analyzeFromImage(videoElement) {
        // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ù‡Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… TensorFlow.js Ø£Ùˆ OpenCV Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
        // ÙˆÙ„ÙƒÙ† Ø­Ø§Ù„ÙŠØ§Ù‹ Ù†Ø¹Ù…Ù„ Ù…Ø­Ø§ÙƒØ§Ø©
        
        const detectedPatterns = this.simulatePatternDetection();
        this.processDetectedPatterns(detectedPatterns);
        return detectedPatterns;
    }

    simulatePatternDetection() {
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§ÙƒØªØ´Ø§Ù Ø£Ù†Ù…Ø§Ø· Big Road Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©
        const patterns = [];
        const patternTypes = ['P', 'B', 'T', 'P', 'B', 'P', 'B', 'B', 'P', 'T', 'B', 'P'];
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù†Ù…Ø§Ø· Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
        for (let i = 0; i < 12; i++) {
            patterns.push({
                type: patternTypes[i],
                position: i,
                confidence: Math.random() * 50 + 50 // 50-100%
            });
        }

        return {
            bigRoad: patterns,
            smallRoad: patterns.slice(0, 6),
            derivedRoad: patterns.slice(0, 4),
            confidence: 85
        };
    }

    processDetectedPatterns(patterns) {
        this.patterns = patterns.bigRoad;
        this.bigRoad = patterns.bigRoad.map(p => p.type);
        this.lastAnalysis = patterns;
        
        this.updateDisplay();
        this.generatePrediction();
    }

    updateDisplay() {
        const bigRoadDisplay = document.getElementById('bigRoadDisplay');
        bigRoadDisplay.innerHTML = '';
        
        this.bigRoad.forEach((pattern, index) => {
            const cell = document.createElement('div');
            cell.className = `pattern-cell pattern-${pattern}`;
            cell.textContent = pattern;
            cell.title = `Position ${index + 1} - Confidence: ${this.patterns[index]?.confidence || 0}%`;
            bigRoadDisplay.appendChild(cell);
        });

        const patternResults = document.getElementById('patternResults');
        patternResults.innerHTML = `
            <div style="margin-bottom:8px;">
                <strong>Big Road Patterns:</strong> ${this.bigRoad.join(' â†’ ')}
            </div>
            <div style="font-size:12px; color:var(--muted);">
                Detected ${this.bigRoad.length} patterns with ${this.lastAnalysis.confidence}% confidence
            </div>
        `;
    }

    generatePrediction() {
        if (this.bigRoad.length < 3) {
            document.getElementById('predictionResult').innerHTML = `
                <div style="color:var(--muted);">Need more patterns for prediction</div>
            `;
            return;
        }

        const prediction = this.calculateAdvancedPrediction();
        
        document.getElementById('predictionResult').innerHTML = `
            <div style="font-size:18px; font-weight:bold; margin-bottom:5px;">
                NEXT: <span style="color:${prediction.color}">${prediction.type}</span>
            </div>
            <div style="font-size:12px; color:var(--muted);">
                Confidence: ${prediction.confidence}% | Pattern: ${prediction.patternType}
            </div>
        `;
    }

    calculateAdvancedPrediction() {
        const lastThree = this.bigRoad.slice(-3);
        const frequencies = this.calculateFrequencies();
        
        let nextPrediction = 'B'; // Default
        let confidence = 60;
        let patternType = 'Basic';

        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¨Ø³ÙŠØ·Ø©
        if (lastThree[0] === lastThree[1]) {
            // P,P Ø£Ùˆ B,B - Ø§Ø­ØªÙ…Ø§Ù„ ÙƒØ³Ø± Ø§Ù„Ø³Ù„Ø³Ù„Ø©
            nextPrediction = lastThree[0] === 'P' ? 'B' : 'P';
            confidence = 65;
            patternType = 'Break Trend';
        } else if (lastThree[0] !== lastThree[1] && lastThree[1] !== lastThree[2]) {
            // ØªÙ†Ø§ÙˆØ¨ P,B,P Ø£Ùˆ B,P,B
            nextPrediction = lastThree[1];
            confidence = 70;
            patternType = 'Alternation';
        }

        // Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø¯Ø¯
        if (frequencies.P > 60) {
            nextPrediction = 'B';
            confidence = Math.max(confidence, 75);
            patternType = 'Frequency Correction';
        } else if (frequencies.B > 60) {
            nextPrediction = 'P';
            confidence = Math.max(confidence, 75);
            patternType = 'Frequency Correction';
        }

        const colors = { P: '#3a86ff', B: '#ff006e', T: '#38b000' };
        
        return {
            type: nextPrediction,
            confidence: Math.min(confidence, 95),
            patternType: patternType,
            color: colors[nextPrediction]
        };
    }

    calculateFrequencies() {
        const counts = { P: 0, B: 0, T: 0 };
        this.bigRoad.forEach(pattern => counts[pattern]++);
        
        const total = this.bigRoad.length;
        return {
            P: (counts.P / total) * 100,
            B: (counts.B / total) * 100,
            T: (counts.T / total) * 100
        };
    }
}

// Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
const patternAnalyzer = new PatternAnalyzer();
let cameraStream = null;

async function startCamera() {
    try {
        cameraStream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: 'environment' } 
        });
        
        const video = document.getElementById('cameraView');
        video.srcObject = cameraStream;
        video.style.display = 'block';
        document.getElementById('analyzeBtn').style.display = 'block';
        
    } catch (error) {
        alert('Camera error: ' + error.message);
    }
}

function stopCamera() {
    if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
    }
    document.getElementById('cameraView').style.display = 'none';
    document.getElementById('analyzeBtn').style.display = 'none';
}

function analyzePattern() {
    const video = document.getElementById('cameraView');
    patternAnalyzer.analyzeFromImage(video);
}

function addResult(type) {
    // Ø¥Ø¶Ø§ÙØ© Ù†ØªÙŠØ¬Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù„Ù„Ø£Ù†Ù…Ø§Ø·
    patternAnalyzer.bigRoad.push(type);
    patternAnalyzer.patterns.push({
        type: type,
        position: patternAnalyzer.bigRoad.length,
        confidence: 100
    });
    patternAnalyzer.updateDisplay();
    patternAnalyzer.generatePrediction();
}

function resetAll() {
    patternAnalyzer.patterns = [];
    patternAnalyzer.bigRoad = [];
    patternAnalyzer.lastAnalysis = null;
    
    document.getElementById('patternResults').innerHTML = '<div style="text-align:center; color:var(--muted);">No patterns detected yet</div>';
    document.getElementById('bigRoadDisplay').innerHTML = '';
    document.getElementById('predictionResult').innerHTML = 'Analyze patterns to see prediction';
}

// Ø¨Ø¯Ø¡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
window.addEventListener('load', () => {
    // startCamera(); // Uncomment to start camera automatically
});
</script>
</body>
</html>
