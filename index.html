<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>BACCARAT PREDICTOR PRO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background-color: #121212;
      color: gold;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      padding: 2em;
      direction: rtl;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    body.light-mode {
      background-color: #f5f5f5;
      color: #333;
    }
    
    h1 { 
      font-size: 2.5em; 
      margin-bottom: 20px; 
    }
    
    .bet-amount-container {
      margin: 20px auto;
      padding: 15px;
      background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,215,0,0.05));
      border-radius: 15px;
      max-width: 300px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,215,0,0.3);
    }
    
    .language-container {
      position: absolute;
      top: 20px;
      left: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .bar {
      height: 24px;
      margin: 8px 0;
      border-radius: 5px;
      text-align: right;
      padding-right: 10px;
      font-weight: bold;
      line-height: 24px;
      color: #fff;
    }
    
    .bar.player { background-color: #007BFF; }
    .bar.banker { background-color: #DC3545; }
    .bar.tie { background-color: #28A745; }
    
    .buttons button {
      padding: 1em 1.8em;
      font-size: 1.1em;
      margin: 0.5em;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      min-width: 120px;
    }
    
    .player { 
      background-color: #007bff; 
      color: white; 
      border-bottom: 4px solid #0056b3;
    }
    
    .banker { 
      background-color: #dc3545; 
      color: white;
      border-bottom: 4px solid #a71d2a;
    }
    
    .tie { 
      background-color: #28a745; 
      color: white;
      border-bottom: 4px solid #1e7e34;
    }
    
    .reset { 
      background-color: #555; 
      color: gold; 
      margin-top: 1.5em;
      padding: 0.8em 2em;
      border-bottom: 4px solid #333;
    }
    
    .results-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1em 0;
      text-align: center;
    }
    
    .player-text { color: #007bff; }
    .banker-text { color: #dc3545; }
    .tie-text { color: #28a745; }
    
    .balance-display {
      font-size: 1.3em;
      font-weight: bold;
      padding: 12px;
      border-radius: 10px;
      background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,215,0,0.05));
      display: inline-block;
      min-width: 200px;
      margin: 10px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    @media (max-width: 768px) {
      body {
        padding: 1em;
      }
      .buttons button {
        padding: 0.8em;
        min-width: 100px;
        font-size: 1em;
      }
    }
  </style>
</head>
<body>
  <div class="language-container">
    <select id="langSelect" class="language">
      <option value="ar-MA">🇲🇦 العربية</option>
      <option value="en-US">🇺🇸 English</option>
    </select>
    <button class="theme-toggle" onclick="toggleTheme()">🌓</button>
  </div>

  <h1>BACCARAT PREDICTOR PRO</h1>
  
  <div class="bet-amount-container">
    <label for="betAmount" مبلغ الرهان بدرهم </label>
    <input type="number" id="betAmount" class="amount" placeholder="أدخل المبلغ (اختياري)" min="1" step="1">
  </div>
  
  <p>📲 اختر نتيجة الجولة:</p>
  <div class="buttons">
    <button class="player" onclick="addResult('P')">
      🔵 اللاعب
      <div class="bet-odds">1:1</div>
    </button>
    <button class="banker" onclick="addResult('B')">
      🔴 المصرفي
      <div class="bet-odds">0.95:1</div>
    </button>
    <button class="tie" onclick="addResult('T')">
      🟢 تعادل
      <div class="bet-odds">8:1</div>
    </button>
  </div>

  <div class="stats" id="statsResult"></div>
  <div class="history" id="historyDisplay"></div>
  <div class="balance-display" id="balanceDisplay">
    💵 الرصيد: <span id="balanceValue">0</span> درهم
  </div>
  
  <div style="margin-top: 20px;">
    <button class="reset" onclick="resetData()">🔄 إعادة تعيين</button>
  </div>

  <canvas id="chart" width="400" height="150"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // المتغيرات العامة
    let history = [];
    let balance = ; // رصيد ابتدائي اختياري درهم
    let balanceHistory = [];
    let currentStreak = { type: null, count: 0 };
    let betsHistory = [];
    let lang = 'ar-MA';
    let chart;

    // تهيئة التطبيق عند التحميل
    document.addEventListener('DOMContentLoaded', function() {
      loadTheme();
      loadLanguage();
      initChart();
      document.getElementById('langSelect').addEventListener('change', changeLanguage);
      document.getElementById('balanceValue').textContent = balance.toFixed(2);
    });

    // وظائف التطبيق الأساسية
    function initChart() {
      const ctx = document.getElementById('chart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: balanceHistory.map((_, i) => i),
          datasets: [{
            label: 'الرصيد',
            data: balanceHistory,
            backgroundColor: 'rgba(255, 215, 0, 0.2)',
            borderColor: 'gold',
            borderWidth: 2,
            pointBackgroundColor: 'gold',
            pointRadius: 4,
            fill: true,
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          }
        }
      });
    }

    function toggleTheme() {
      document.body.classList.toggle('light-mode');
      localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
    }

    function loadTheme() {
      if (localStorage.getItem('theme') === 'light') {
        document.body.classList.add('light-mode');
      }
    }

    function changeLanguage() {
      lang = document.getElementById('langSelect').value;
      localStorage.setItem('lang', lang);
      updateUI();
    }

    function loadLanguage() {
      const savedLang = localStorage.getItem('lang') || 'ar-MA';
      document.getElementById('langSelect').value = savedLang;
      lang = savedLang;
    }

    function addResult(result) {
      const betAmount = parseFloat(document.getElementById('betAmount').value) || 0;
      document.getElementById('betAmount').value = '';
      
      if (betAmount > balance && betAmount > 0) {
        alert(lang === 'ar-MA' ? 'الرصيد غير كافي!' : 'Insufficient balance!');
        return;
      }
      
      history.push(result);
      
      // تحديث السلسلة الحالية
      if (result === currentStreak.type) {
        currentStreak.count++;
      } else {
        currentStreak.type = result;
        currentStreak.count = 1;
      }
      
      const round = history.length;
      const betOn = event.target.classList.contains('player') ? 'P' : 
                   event.target.classList.contains('banker') ? 'B' : 'T';
      
      const profit = calculateProfit(betOn, result, betAmount);
      
      betsHistory.push({
        round,
        betOn,
        amount: betAmount,
        outcome: result,
        profit,
        timestamp: new Date()
      });
      
      updateBalance(profit);
      updateDisplay();
      updatePredictions();
    }

    // الدالة المصححة لحساب الربح
    function calculateProfit(betOn, outcome, amount) {
      if (!amount || amount <= 0) return 0;
      
      if (betOn === outcome) {
        if (betOn === 'T') return amount * 0;  // ربح 0 أضعاف المبلغ عند التعادل
        if (betOn === 'B') return amount * 0.95; // ربح 95% من المبلغ عند المصرفي
        return amount * 1; // ربح مساوي للمبلغ عند اللاعب
      }
      return -amount; // خسارة كامل المبلغ المراهن
    }

    function updateBalance(profit) {
      balance += profit;
      balanceHistory.push(balance);
      document.getElementById('balanceValue').textContent = balance.toFixed(2);
      
      // تحديث الرسم البياني
      chart.data.labels = balanceHistory.map((_, i) => i);
      chart.data.datasets[0].data = balanceHistory;
      chart.update();
      
      // تأثير بسيط عند تغيير الرصيد
      const balanceDisplay = document.getElementById('balanceDisplay');
      balanceDisplay.style.transform = 'scale(1.05)';
      setTimeout(() => {
        balanceDisplay.style.transform = 'scale(1)';
      }, 300);
    }

    function updateDisplay() {
      const displayText = history.map(r => {
        if (r === 'P') return '🔵';
        if (r === 'B') return '🔴';
        if (r === 'T') return '🟢';
      }).join(' ');
      document.getElementById('historyDisplay').innerText = (lang === 'ar-MA' ? "جميع الجولات: " : "All rounds: ") + displayText;

      const totalRounds = history.length;
      const count = { P: 0, B: 0, T: 0 };
      history.forEach(r => { if (count[r] !== undefined) count[r]++; });

      const statsHTML = `
        <table class="results-table">
          <tr>
            <th>${lang === 'ar-MA' ? 'عدد الجولات' : 'Rounds'}</th>
            <th class="player-text">${lang === 'ar-MA' ? 'لاعب' : 'Player'}</th>
            <th class="banker-text">${lang === 'ar-MA' ? 'مصرفي' : 'Banker'}</th>
            <th class="tie-text">${lang === 'ar-MA' ? 'تعادل' : 'Tie'}</th>
          </tr>
          <tr>
            <td>${totalRounds}</td>
            <td class="player-text">${count.P} (${((count.P/totalRounds)*100).toFixed(1)}%)</td>
            <td class="banker-text">${count.B} (${((count.B/totalRounds)*100).toFixed(1)}%)</td>
            <td class="tie-text">${count.T} (${((count.T/totalRounds)*100).toFixed(1)}%)</td>
          </tr>
        </table>
      `;
      document.getElementById('statsResult').innerHTML = statsHTML;
    }

    function updatePredictions() {
      const prediction = advancedPredict(history);
      displayPrediction(prediction);
    }

    function advancedPredict(history) {
      if (history.length < 3) {
        return { P: 33.3, B: 33.3, T: 33.3 };
      }

      const lastFive = history.slice(-5);
      const lastTen = history.length >= 10 ? history.slice(-10) : lastFive;
      
      const freq5 = { P: 0, B: 0, T: 0 };
      const freq10 = { P: 0, B: 0, T: 0 };
      
      lastFive.forEach(r => freq5[r]++);
      lastTen.forEach(r => freq10[r]++);
      
      const percent5 = {
        P: (freq5.P / 5) * 100,
        B: (freq5.B / 5) * 100,
        T: (freq5.T / 5) * 100
      };
      
      const percent10 = {
        P: (freq10.P / lastTen.length) * 100,
        B: (freq10.B / lastTen.length) * 100,
        T: (freq10.T / lastTen.length) * 100
      };
      
      const weightedAvg = {
        P: (percent5.P * 0.6 + percent10.P * 0.4),
        B: (percent5.B * 0.6 + percent10.B * 0.4),
        T: (percent5.T * 0.6 + percent10.T * 0.4)
      };
      
      const total = weightedAvg.P + weightedAvg.B + weightedAvg.T;
      return {
        P: (weightedAvg.P / total * 100),
        B: (weightedAvg.B / total * 100),
        T: (weightedAvg.T / total * 100)
      };
    }

    function displayPrediction(prediction) {
      const isArabic = lang === 'ar-MA';
      const statsHTML = `
        <span class="player-text">🔵 ${isArabic ? 'لاعب' : 'Player'}: ${prediction.P.toFixed(1)}%</span> | 
        <span class="banker-text">🔴 ${isArabic ? 'مصرفي' : 'Banker'}: ${prediction.B.toFixed(1)}%</span> | 
        <span class="tie-text">🟢 ${isArabic ? 'تعادل' : 'Tie'}: ${prediction.T.toFixed(1)}%</span>
      `;
      document.getElementById('statsResult').innerHTML += `<div style="margin-top:10px;">${statsHTML}</div>`;
    }

    function resetData() {
      const isArabic = lang === 'ar-MA';
      if (confirm(isArabic ? 
          "هل أنت متأكد من أنك تريد إعادة تعيين جميع البيانات؟" : 
          "Are you sure you want to reset all data?")) {
        history = [];
        balance = 1000;
        balanceHistory = [1000];
        betsHistory = [];
        currentStreak = { type: null, count: 0 };
        initChart();
        document.getElementById('statsResult').innerText = '';
        document.getElementById('historyDisplay').innerText = '';
        document.getElementById('balanceValue').textContent = '1000.00';
        document.getElementById('betAmount').value = '';
      }
    }

    function updateUI() {
      const isArabic = lang === 'ar-MA';
      document.querySelector('h1').textContent = 'BACCARAT PREDICTOR PRO';
      document.querySelector('.bet-amount-container label').textContent = isArabic ? '💰 مبلغ الرهان بالدرهم' : '💰 Bet Amount (MAD)';
      document.querySelector('#betAmount').placeholder = isArabic ? 'أدخل المبلغ (اختياري)' : 'Enter amount (optional)';
      document.querySelector('p').textContent = isArabic ? '📲 اختر نتيجة الجولة:' : '📲 Select round result:';
      document.querySelector('.player').innerHTML = isArabic ? '🔵 اللاعب <div class="bet-odds">1:1</div>' : '🔵 Player <div class="bet-odds">1:1</div>';
      document.querySelector('.banker').innerHTML = isArabic ? '🔴 المصرفي <div class="bet-odds">0.95:1</div>' : '🔴 Banker <div class="bet-odds">0.95:1</div>';
      document.querySelector('.tie').innerHTML = isArabic ? '🟢 تعادل <div class="bet-odds">8:1</div>' : '🟢 Tie <div class="bet-odds">8:1</div>';
      document.querySelector('#balanceDisplay').innerHTML = isArabic ? '💵 الرصيد: <span id="balanceValue">1000.00</span> درهم' : '💵 Balance: <span id="balanceValue">1000.00</span> MAD';
      document.querySelector('.reset').textContent = isArabic ? '🔄 إعادة تعيين' : '🔄 Reset';
    }
  </script>
</body>
</html>
