<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>BACCARAT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background-color: #121212;
      color: gold;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      padding: 2em;
      direction: rtl;
      text-align: center;
      transition: all 0.3s ease;
    }
    body.light-mode {
      background-color: #f5f5f5;
      color: #333;
    }
    h1 { font-size: 2.5em; }
    .buttons button {
      padding: 0.7em 1.5em;
      font-size: 1em;
      margin: 0.5em;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .player { background-color: #007bff; color: white; }
    .banker { background-color: #dc3545; color: white; }
    .tie { background-color: #28a745; color: white; }
    .reset { background-color: #555; color: gold; margin-top: 1em; }
    .language-container {
      position: absolute;
      top: 20px;
      left: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .language, .amount {
      padding: 0.5em;
      font-size: 1em;
      width: 150px;
    }
    .result, .stats, .history, .balance, .ai-stats, .ai-advice {
      margin-top: 1.5em;
      font-size: 1.2em;
      padding: 10px;
      border-radius: 8px;
      background-color: rgba(0,0,0,0.2);
    }
    body.light-mode .result, 
    body.light-mode .stats, 
    body.light-mode .history, 
    body.light-mode .balance, 
    body.light-mode .ai-stats, 
    body.light-mode .ai-advice {
      background-color: rgba(0,0,0,0.05);
    }
    canvas {
      margin-top: 2em;
      max-width: 100%;
    }
    .theme-toggle {
      background: none;
      border: none;
      font-size: 1.5em;
      cursor: pointer;
      color: gold;
    }
    body.light-mode .theme-toggle {
      color: #333;
    }
    .ai-advice {
      border-left: 4px solid gold;
    }
    .player-text { color: #007bff; }
    .banker-text { color: #dc3545; }
    .tie-text { color: #28a745; }
    
    /* أنماط الجداول */
    .results-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1em 0;
      text-align: center;
    }
    .results-table th, .results-table td {
      padding: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    body.light-mode .results-table th, 
    body.light-mode .results-table td {
      border-color: rgba(0, 0, 0, 0.1);
    }
    
    /* أنماط الميجورك */
    .big-road-container {
      margin-top: 2em;
      padding: 1em;
      background-color: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      direction: ltr;
      overflow-x: auto;
    }
    .big-road {
      display: inline-grid;
      grid-auto-flow: column;
      grid-template-rows: repeat(6, 30px);
      gap: 4px;
      padding: 10px;
    }
    .big-road-cell {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .big-road-P { background-color: #007bff; color: white; }
    .big-road-B { background-color: #dc3545; color: white; }
    .big-road-T { background-color: #28a745; color: white; }
    
    /* أنماط جديدة للتوقعات */
    .prediction-title {
      color: gold;
      font-size: 1.3em;
      font-weight: bold;
      margin-bottom: 5px;
      text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
    }
    
    .prediction-value {
      font-size: 1.2em;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 5px;
      display: inline-block;
    }
    
    .prediction-banker {
      background-color: rgba(220, 53, 69, 0.2);
      color: #dc3545;
    }
    
    .prediction-player {
      background-color: rgba(0, 123, 255, 0.2);
      color: #007bff;
    }
    
    .prediction-tie {
      background-color: rgba(40, 167, 69, 0.2);
      color: #28a745;
    }
    
    /* أنماط الجدول الجديد للنتائج الساخنة */
    .hot-results-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      overflow: hidden;
    }
    
    .hot-results-table th {
      background-color: rgba(255, 215, 0, 0.1);
      padding: 8px;
      text-align: center;
    }
    
    .hot-results-table td {
      padding: 8px;
      text-align: center;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .hot { color: #FF5722; font-weight: bold; }
    .cold { color: #2196F3; font-weight: bold; }
  </style>
</head>
<body>
  <div class="language-container">
    <select id="langSelect" class="language">
      <option value="ar-MA">🇲🇦 العربية</option>
      <option value="en-US">🇺🇸 English</option>
    </select>
    <button class="theme-toggle" onclick="toggleTheme()">🌓</button>
  </div>

  <h1>BACCARAT</h1>
  <p>📲 اختر نتيجة كل جولة:</p>
  <div class="buttons">
    <button class="player" onclick="addResult('P')">🔵 اللاعب</button>
    <button class="banker" onclick="addResult('B')">🔴 المصرفي</button>
    <button class="tie" onclick="addResult('T')">🟢 تعادل</button>
  </div>

  <input type="number" id="betAmount" class="amount" placeholder="💰 مبلغ الرهان بالدرهم" />
  <br />

  <div class="result" id="predictionResult"></div>
  <div class="stats" id="statsResult"></div>
  <div class="ai-stats" id="aiStats"></div>
  <div class="ai-advice" id="aiAdvice"></div>
  <div class="history" id="historyDisplay"></div>
  <div class="balance" id="balanceDisplay">💵 الرصيد: 0 درهم</div>
  <button class="reset" onclick="resetData()">🔄 إعادة تعيين</button>

  <canvas id="chart" width="400" height="150"></canvas>

  <!-- قسم الميجورك -->
  <div class="big-road-container">
    <h2>Big Road (الميجورك)</h2>
    <div id="bigRoad" class="big-road"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let history = [];
    let balance = 0;
    let balanceHistory = [];
    let currentStreak = { type: null, count: 0 };

    // تحميل الوضع من localStorage إذا كان موجوداً
    if (localStorage.getItem('theme') === 'light') {
      document.body.classList.add('light-mode');
    }

    const ctx = document.getElementById('chart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'الرصيد',
          data: [],
          backgroundColor: 'gold',
          borderColor: 'gold',
          fill: false,
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    function toggleTheme() {
      document.body.classList.toggle('light-mode');
      const isLight = document.body.classList.contains('light-mode');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
    }

    function speak(text, lang) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = lang;
      speechSynthesis.speak(utter);
    }

    function updateChart() {
      chart.data.labels = balanceHistory.map((_, i) => i + 1);
      chart.data.datasets[0].data = balanceHistory;
      chart.update();
    }

    // دالة تحديث الميجورك
    function updateBigRoad() {
      const bigRoadElement = document.getElementById('bigRoad');
      bigRoadElement.innerHTML = '';
      
      let row = 0;
      let col = 0;
      const maxRows = 6;

      const filteredHistory = history.filter(result => result !== 'T');

      for (let i = 0; i < filteredHistory.length; i++) {
        const result = filteredHistory[i];
        
        if (i > 0 && result === filteredHistory[i - 1]) {
          row++;
          if (row >= maxRows) {
            row = 0;
            col++;
          }
        } else {
          row = 0;
          if (i > 0) col++;
        }

        const cell = document.createElement('div');
        cell.className = `big-road-cell big-road-${result}`;
        cell.textContent = result === 'P' ? 'P' : 'B';
        cell.style.gridColumn = col + 1;
        cell.style.gridRow = row + 1;
        bigRoadElement.appendChild(cell);
      }
    }

    function addResult(result) {
      history.push(result);
      
      // تحديث السلسلة الحالية
      if (result === currentStreak.type) {
        currentStreak.count++;
        // تنبيه عند الوصول إلى 3 جولات متتالية
        if (currentStreak.count === 3) {
          const lang = document.getElementById('langSelect').value;
          const message = lang === 'ar-MA' 
            ? `📣 انتباه! سلسلة ${result === 'P' ? 'لاعب' : 'مصرفي'} مستمرة!` 
            : `📣 Alert! ${result === 'P' ? 'Player' : 'Banker'} streak!`;
          alert(message);
          speak(message, lang);
        }
      } else {
        currentStreak.type = result;
        currentStreak.count = 1;
      }
      
      updateDisplay();
      updateBigRoad();
      predict(result);
      generateAdvice();
    }

    function updateDisplay() {
      const displayText = history.map(r => {
        if (r === 'P') return '🔵';
        if (r === 'B') return '🔴';
        if (r === 'T') return '🟢';
      }).join(' ');
      document.getElementById('historyDisplay').innerText = "جميع الجولات: " + displayText;

      const totalRounds = history.length;
      const count = { P: 0, B: 0, T: 0 };
      history.forEach(r => { if (count[r] !== undefined) count[r]++; });

      const statsHTML = `
        <table class="results-table">
          <tr>
            <th>عدد الجولات</th>
            <th class="player-text">لاعب</th>
            <th class="banker-text">مصرفي</th>
            <th class="tie-text">تعادل</th>
          </tr>
          <tr>
            <td>${totalRounds}</td>
            <td class="player-text">${count.P} (${((count.P/totalRounds)*100).toFixed(1)}%)</td>
            <td class="banker-text">${count.B} (${((count.B/totalRounds)*100).toFixed(1)}%)</td>
            <td class="tie-text">${count.T} (${((count.T/totalRounds)*100).toFixed(1)}%)</td>
          </tr>
        </table>
      `;
      document.getElementById('aiStats').innerHTML = statsHTML;
    }

    function generateAdvice() {
      const lang = document.getElementById('langSelect').value;
      const isArabic = lang === 'ar-MA';
      
      if (history.length < 3) {
        document.getElementById('aiAdvice').innerHTML = isArabic ? 
          "⏳ انتظر المزيد من الجولات لتحليل الأنماط..." : 
          "⏳ Wait for more rounds to analyze patterns...";
        return;
      }

      const lastTen = history.slice(-10);
      const counts = { P: 0, B: 0, T: 0 };
      lastTen.forEach(r => counts[r]++);
      
      const mostFrequent = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
      const freqPercent = (counts[mostFrequent] / lastTen.length * 100).toFixed(1);
      
      let streakText = "";
      if (currentStreak.count > 2) {
        const typeName = isArabic ? 
          (currentStreak.type === 'P' ? 'اللاعب' : currentStreak.type === 'B' ? 'المصرفي' : 'تعادل') :
          (currentStreak.type === 'P' ? 'Player' : currentStreak.type === 'B' ? 'Banker' : 'Tie');
        
        streakText = isArabic ?
          `📈 سلسلة ${typeName} مستمرة: ${currentStreak.count} جولات` :
          `📈 ${typeName} streak: ${currentStreak.count} rounds`;
      }

      // جدول النتائج الساخنة
      const hotResultsHTML = `
        <table class="hot-results-table">
          <tr>
            <th>${isArabic ? 'النتيجة' : 'Result'}</th>
            <th>${isArabic ? 'عدد المرات' : 'Count'}</th>
            <th>${isArabic ? 'النسبة' : 'Percentage'}</th>
          </tr>
          <tr>
            <td class="player-text">${isArabic ? 'لاعب' : 'Player'}</td>
            <td>${counts.P}</td>
            <td class="player-text">${((counts.P / lastTen.length) * 100).toFixed(1)}%</td>
          </tr>
          <tr>
            <td class="banker-text">${isArabic ? 'مصرفي' : 'Banker'}</td>
            <td>${counts.B}</td>
            <td class="banker-text">${((counts.B / lastTen.length) * 100).toFixed(1)}%</td>
          </tr>
          <tr>
            <td class="tie-text">${isArabic ? 'تعادل' : 'Tie'}</td>
            <td>${counts.T}</td>
            <td class="tie-text">${((counts.T / lastTen.length) * 100).toFixed(1)}%</td>
          </tr>
        </table>
      `;

      let recommendation = "";
      if (currentStreak.count >= 3) {
        recommendation = isArabic ?
          `💡 استمر في الرهان على <span class="${currentStreak.type === 'P' ? 'player-text' : currentStreak.type === 'B' ? 'banker-text' : 'tie-text'}">${currentStreak.type === 'P' ? 'اللاعب' : currentStreak.type === 'B' ? 'المصرفي' : 'تعادل'}</span>` :
          `💡 Keep betting on <span class="${currentStreak.type === 'P' ? 'player-text' : currentStreak.type === 'B' ? 'banker-text' : 'tie-text'}">${currentStreak.type === 'P' ? 'Player' : currentStreak.type === 'B' ? 'Banker' : 'Tie'}</span>`;
      } else if (parseFloat(freqPercent) > 50) {
        const typeName = isArabic ?
          (mostFrequent === 'P' ? 'اللاعب' : mostFrequent === 'B' ? 'المصرفي' : 'تعادل') :
          (mostFrequent === 'P' ? 'Player' : mostFrequent === 'B' ? 'Banker' : 'Tie');
        
        recommendation = isArabic ?
          `💡 رهان آمن على <span class="${mostFrequent === 'P' ? 'player-text' : mostFrequent === 'B' ? 'banker-text' : 'tie-text'}">${typeName}</span> (${freqPercent}%)` :
          `💡 Safe bet on <span class="${mostFrequent === 'P' ? 'player-text' : mostFrequent === 'B' ? 'banker-text' : 'tie-text'}">${typeName}</span> (${freqPercent}%)`;
      } else {
        recommendation = isArabic ?
          "💡 لا يوجد نمط واضح، استخدم استراتيجية متحفظة" :
          "💡 No clear pattern, use conservative strategy";
      }

      document.getElementById('aiAdvice').innerHTML = `
        ${streakText ? `<div>${streakText}</div>` : ''}
        ${hotResultsHTML}
        <div style="margin-top: 10px;">${recommendation}</div>
      `;
    }

    function predict(actualResult) {
      const lang = document.getElementById('langSelect').value;
      const lastFive = history.slice(-5);
      const count = { P: 0, B: 0, T: 0 };
      lastFive.forEach(r => { if (count[r] !== undefined) count[r]++; });

      const total = lastFive.length || 1;
      const percent = {
        P: ((count.P / total) * 100).toFixed(1),
        B: ((count.B / total) * 100).toFixed(1),
        T: ((count.T / total) * 100).toFixed(1)
      };

      let winner = 'P';
      if (count.B >= count.P && count.B >= count.T) winner = 'B';
      else if (count.T > count.P && count.T > count.B) winner = 'T';

      const labels = {
        ar: { P: 'اللاعب', B: 'المصرفي', T: 'تعادل' },
        en: { P: 'Player', B: 'Banker', T: 'Tie' }
      };

      const label = lang === 'ar-MA' ? labels.ar[winner] : labels.en[winner];
      const predictionClass = winner === 'P' ? 'prediction-player' : winner === 'B' ? 'prediction-banker' : 'prediction-tie';
      
      const predictionHTML = `
        <div class="prediction-title">${lang === 'ar-MA' ? 'توقع الجولة القادمة:' : 'Next round prediction:'}</div>
        <div class="prediction-value ${predictionClass}">
          ${label} ${percent[winner]}%
        </div>
      `;

      document.getElementById('predictionResult').innerHTML = predictionHTML;
      
      const statsHTML = `
        <span class="player-text">🔵 لاعب: ${percent.P}%</span> | 
        <span class="banker-text">🔴 مصرفي: ${percent.B}%</span> | 
        <span class="tie-text">🟢 تعادل: ${percent.T}%</span>
      `;
      
      document.getElementById('statsResult').innerHTML = statsHTML;

      const speechText = lang === 'ar-MA'
        ? `توقع الجولة القادمة: ${label} بنسبة ${percent[winner]} بالمئة`
        : `Next round prediction: ${label} with ${percent[winner]} percent`;

      speak(speechText, lang);

      const bet = parseFloat(document.getElementById('betAmount').value) || 0;
      if (actualResult && winner && bet > 0) {
        if (actualResult === winner) {
          balance += bet;
        } else {
          balance -= bet;
        }
        balanceHistory.push(balance);
        updateChart();
        document.getElementById('balanceDisplay').innerText = `💵 الرصيد: ${balance} درهم`;
      }
    }

    function resetData() {
      history = [];
      balance = 0;
      balanceHistory = [];
      currentStreak = { type: null, count: 0 };
      updateChart();
      updateBigRoad();
      document.getElementById('predictionResult').innerText = '';
      document.getElementById('statsResult').innerText = '';
      document.getElementById('aiStats').innerText = '';
      document.getElementById('aiAdvice').innerText = '';
      document.getElementById('historyDisplay').innerText = '';
      document.getElementById('balanceDisplay').innerText = '💵 الرصيد: 0 درهم';
    }

    if (history.length > 0) {
      updateBigRoad();
    }
  </script>
</body>
    </html>
