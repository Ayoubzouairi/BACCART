<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>BACCARAT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background-color: #121212;
      color: gold;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      padding: 2em;
      direction: rtl;
      text-align: center;
      transition: all 0.3s ease;
    }
    body.light-mode {
      background-color: #f5f5f5;
      color: #333;
    }
    h1 { font-size: 2.5em; margin-bottom: 0.5em; }
    .buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 1em 0;
    }
    .buttons button {
      padding: 0.8em 1.6em;
      font-size: 1.1em;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
    }
    .player { background-color: #007bff; color: white; }
    .banker { background-color: #dc3545; color: white; }
    .tie { background-color: #28a745; color: white; }
    .reset { 
      background-color: #555; 
      color: gold;
      padding: 0.6em 1.2em;
      margin-top: 1.5em;
    }
    .language-container {
      position: absolute;
      top: 20px;
      left: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .language {
      padding: 0.6em;
      font-size: 1em;
      width: 150px;
      border-radius: 8px;
      border: 1px solid #555;
    }
    .amount {
      padding: 0.7em;
      font-size: 1em;
      width: 250px;
      border-radius: 8px;
      border: 1px solid #555;
      margin: 0.5em 0;
    }
    .result, .stats, .history, .balance, .ai-stats, .ai-advice {
      margin: 1em auto;
      padding: 12px;
      border-radius: 8px;
      background-color: rgba(0,0,0,0.2);
      max-width: 600px;
    }
    body.light-mode .result, 
    body.light-mode .stats, 
    body.light-mode .history, 
    body.light-mode .balance, 
    body.light-mode .ai-stats, 
    body.light-mode .ai-advice {
      background-color: rgba(0,0,0,0.05);
    }
    canvas {
      margin: 1.5em auto;
      max-width: 100%;
      display: block;
    }
    .theme-toggle {
      background: none;
      border: none;
      font-size: 1.5em;
      cursor: pointer;
      color: gold;
      padding: 5px;
    }
    body.light-mode .theme-toggle {
      color: #333;
    }
    .ai-advice {
      border-left: 4px solid gold;
      text-align: right;
      padding-right: 15px;
    }
    .probability {
      color: #4CAF50;
      font-weight: bold;
    }
    .hot {
      color: #FF5722;
      font-weight: bold;
    }
    .cold {
      color: #2196F3;
      font-weight: bold;
    }
    .big-road-container {
      margin: 2em auto;
      padding: 1em;
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      direction: ltr;
      overflow-x: auto;
      max-width: 800px;
    }
    .big-road {
      display: inline-grid;
      grid-auto-flow: column;
      grid-template-rows: repeat(6, 30px);
      gap: 2px;
      padding: 10px;
    }
    .big-road-cell {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
    }
    .big-road-P { background-color: #007bff; color: white; }
    .big-road-B { background-color: #dc3545; color: white; }
    .big-road-T { background-color: #28a745; color: white; }
    .win { color: #28a745; }
    .loss { color: #dc3545; }
  </style>
</head>
<body>
  <div class="language-container">
    <select id="langSelect" class="language">
      <option value="ar-MA">ğŸ‡²ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
      <option value="en-US">ğŸ‡ºğŸ‡¸ English</option>
    </select>
    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“</button>
  </div>

  <h1>BACCARAT</h1>
  <p>ğŸ“² Ø§Ø®ØªØ± Ù†ØªÙŠØ¬Ø© ÙƒÙ„ Ø¬ÙˆÙ„Ø©:</p>
  
  <div class="buttons">
    <button class="player" onclick="placeBet('P')">ğŸ”µ Ø§Ù„Ù„Ø§Ø¹Ø¨</button>
    <button class="banker" onclick="placeBet('B')">ğŸ”´ Ø§Ù„Ù…ØµØ±ÙÙŠ</button>
    <button class="tie" onclick="placeBet('T')">ğŸŸ¢ ØªØ¹Ø§Ø¯Ù„</button>
  </div>

  <input type="number" id="betAmount" class="amount" placeholder="ğŸ’° Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ù‡Ø§Ù† Ø¨Ø§Ù„Ø¯Ø±Ù‡Ù…" min="1" />
  
  <div class="result" id="predictionResult"></div>
  <div class="stats" id="statsResult"></div>
  <div class="ai-stats" id="aiStats"></div>
  <div class="ai-advice" id="aiAdvice"></div>
  <div class="history" id="historyDisplay"></div>
  <div class="balance" id="balanceDisplay">ğŸ’µ Ø§Ù„Ø±ØµÙŠØ¯: 0 Ø¯Ø±Ù‡Ù…</div>
  
  <button class="reset" onclick="resetData()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>

  <canvas id="chart" width="600" height="200"></canvas>

  <div class="big-road-container">
    <h2>Big Road (Ø§Ù„Ù…ÙŠØ¬ÙˆØ±Ùƒ)</h2>
    <div id="bigRoad" class="big-road"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    let history = [];
    let balance = 0;
    let balanceHistory = [];
    let currentStreak = { type: null, count: 0 };
    let currentBet = { amount: 0, type: null };
    let lastBetResult = null;

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
    const ctx = document.getElementById('chart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Ø§Ù„Ø±ØµÙŠØ¯',
          data: [],
          backgroundColor: 'rgba(255, 215, 0, 0.2)',
          borderColor: 'gold',
          borderWidth: 2,
          tension: 0.1,
          fill: true,
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { 
            beginAtZero: true,
            grid: { color: 'rgba(255, 255, 255, 0.1)' }
          },
          x: { grid: { color: 'rgba(255, 255, 255, 0.1)' } }
        }
      }
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    function loadData() {
      const savedData = localStorage.getItem('baccaratData');
      if (savedData) {
        const data = JSON.parse(savedData);
        history = data.history || [];
        balance = data.balance || 0;
        balanceHistory = data.balanceHistory || [];
        currentBet = data.currentBet || { amount: 0, type: null };
        
        if (localStorage.getItem('theme') === 'light') {
          document.body.classList.add('light-mode');
        }
        
        updateAllDisplays();
      }
    }

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function saveData() {
      const data = {
        history,
        balance,
        balanceHistory,
        currentBet,
        theme: document.body.classList.contains('light-mode') ? 'light' : 'dark'
      };
      localStorage.setItem('baccaratData', JSON.stringify(data));
      localStorage.setItem('theme', data.theme);
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…/Ø§Ù„ÙØ§ØªØ­
    function toggleTheme() {
      document.body.classList.toggle('light-mode');
      saveData();
    }

    // ÙˆØ¶Ø¹ Ø§Ù„Ø±Ù‡Ø§Ù†
    function placeBet(betType) {
      const betAmount = parseFloat(document.getElementById('betAmount').value);
      
      if (!betAmount || betAmount <= 0) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº Ø±Ù‡Ø§Ù† ØµØ­ÙŠØ­');
        return;
      }
      
      currentBet = {
        type: betType,
        amount: betAmount
      };
      
      const lang = document.getElementById('langSelect').value;
      const betName = getBetName(betType, lang);
      const message = lang === 'ar-MA' 
        ? `âœ” ØªÙ… ÙˆØ¶Ø¹ Ø±Ù‡Ø§Ù† ${betAmount} Ø¯Ø±Ù‡Ù… Ø¹Ù„Ù‰ ${betName}`
        : `âœ” Bet placed: ${betAmount} on ${betName}`;
      
      document.getElementById('predictionResult').textContent = message;
      speak(message, lang);
    }

    // Ø¥Ø¶Ø§ÙØ© Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¬ÙˆÙ„Ø©
    function addResult(result) {
      if (currentBet.type && currentBet.amount > 0) {
        processBetResult(result);
      }
      
      history.push(result);
      updateStreak(result);
      updateAllDisplays();
      saveData();
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø±Ù‡Ø§Ù†
    function processBetResult(result) {
      const betWon = currentBet.type === result;
      lastBetResult = betWon ? 'win' : 'loss';
      
      if (betWon) {
        balance += currentBet.amount;
      } else {
        balance -= currentBet.amount;
      }
      
      balanceHistory.push(balance);
      currentBet = { amount: 0, type: null };
      updateChart();
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©
    function updateStreak(result) {
      if (result === currentStreak.type) {
        currentStreak.count++;
      } else {
        currentStreak.type = result;
        currentStreak.count = 1;
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø±ÙˆØ¶
    function updateAllDisplays() {
      updateHistoryDisplay();
      updateStatsDisplay();
      updateBigRoad();
      updateBalanceDisplay();
      generateAdvice();
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ®
    function updateHistoryDisplay() {
      const displayText = history.map(r => {
        if (r === 'P') return 'ğŸ”µ';
        if (r === 'B') return 'ğŸ”´';
        if (r === 'T') return 'ğŸŸ¢';
      }).join(' ');
      document.getElementById('historyDisplay').innerText = "Ø§Ù„Ø³Ø¬Ù„: " + displayText;
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    function updateStatsDisplay() {
      const totalRounds = history.length;
      if (totalRounds === 0) return;

      const count = { P: 0, B: 0, T: 0 };
      history.forEach(r => count[r]++);

      const lang = document.getElementById('langSelect').value;
      const isArabic = lang === 'ar-MA';

      const statsText = isArabic
        ? `ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${totalRounds} Ø¬ÙˆÙ„Ø© | ğŸ”µ Ù„Ø§Ø¹Ø¨: ${count.P} (${((count.P/totalRounds)*100).toFixed(1)}%) | ğŸ”´ Ù…ØµØ±ÙÙŠ: ${count.B} (${((count.B/totalRounds)*100).toFixed(1)}%) | ğŸŸ¢ ØªØ¹Ø§Ø¯Ù„: ${count.T} (${((count.T/totalRounds)*100).toFixed(1)}%)`
        : `ğŸ“Š Stats: ${totalRounds} rounds | ğŸ”µ Player: ${count.P} (${((count.P/totalRounds)*100).toFixed(1)}%) | ğŸ”´ Banker: ${count.B} (${((count.B/totalRounds)*100).toFixed(1)}%) | ğŸŸ¢ Tie: ${count.T} (${((count.T/totalRounds)*100).toFixed(1)}%)`;

      document.getElementById('aiStats').innerText = statsText;
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯
    function updateBalanceDisplay() {
      const lang = document.getElementById('langSelect').value;
      const isArabic = lang === 'ar-MA';
      
      let balanceText = isArabic 
        ? `ğŸ’µ Ø§Ù„Ø±ØµÙŠØ¯: ${balance} Ø¯Ø±Ù‡Ù…` 
        : `ğŸ’µ Balance: ${balance} DH`;
      
      if (lastBetResult) {
        balanceText += lastBetResult === 'win' 
          ? ` <span class="win">${isArabic ? '(Ø±Ø¨Ø­)' : '(Win)'}</span>`
          : ` <span class="loss">${isArabic ? '(Ø®Ø³Ø§Ø±Ø©)' : '(Loss)'}</span>`;
      }
      
      document.getElementById('balanceDisplay').innerHTML = balanceText;
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙŠØ¬ÙˆØ±Ùƒ
    function updateBigRoad() {
      const bigRoadElement = document.getElementById('bigRoad');
      bigRoadElement.innerHTML = '';
      
      let row = 0;
      let col = 0;
      const maxRows = 6;
      const filteredHistory = history.filter(result => result !== 'T');

      for (let i = 0; i < filteredHistory.length; i++) {
        const result = filteredHistory[i];
        
        if (i > 0 && result === filteredHistory[i - 1]) {
          row++;
          if (row >= maxRows) {
            row = 0;
            col++;
          }
        } else {
          row = 0;
          if (i > 0) col++;
        }

        const cell = document.createElement('div');
        cell.className = `big-road-cell big-road-${result}`;
        cell.textContent = result === 'P' ? 'P' : 'B';
        cell.style.gridColumn = col + 1;
        cell.style.gridRow = row + 1;
        bigRoadElement.appendChild(cell);
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
    function updateChart() {
      chart.data.labels = balanceHistory.map((_, i) => i + 1);
      chart.data.datasets[0].data = balanceHistory;
      chart.update();
    }

    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†ØµÙŠØ­Ø©
    function generateAdvice() {
      const lang = document.getElementById('langSelect').value;
      const isArabic = lang === 'ar-MA';
      
      if (history.length < 3) {
        document.getElementById('aiAdvice').innerHTML = isArabic 
          ? "â³ Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø·..." 
          : "â³ Wait for more rounds to analyze patterns...";
        return;
      }

      // ØªØ­Ù„ÙŠÙ„ Ø¢Ø®Ø± 10 Ø¬ÙˆÙ„Ø§Øª
      const lastTen = history.slice(-10);
      const counts = { P: 0, B: 0, T: 0 };
      lastTen.forEach(r => counts[r]++);
      
      const mostFrequent = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
      const freqPercent = (counts[mostFrequent] / lastTen.length * 100).toFixed(1);
      
      // Ù†Øµ Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©
      let streakText = "";
      if (currentStreak.count > 2) {
        const typeName = getBetName(currentStreak.type, lang);
        streakText = isArabic
          ? `ğŸ“ˆ Ø³Ù„Ø³Ù„Ø© ${typeName} Ù…Ø³ØªÙ…Ø±Ø©: ${currentStreak.count} Ø¬ÙˆÙ„Ø§Øª`
          : `ğŸ“ˆ ${typeName} streak: ${currentStreak.count} rounds`;
      }

      // Ù†Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø³Ø§Ø®Ù†Ø©/Ø§Ù„Ø¨Ø§Ø±Ø¯Ø©
      let hotColdText = "";
      const hotCold = { P: 0, B: 0, T: 0 };
      history.forEach(r => hotCold[r]++);
      
      hotColdText = isArabic ? "ğŸ”¥ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø³Ø§Ø®Ù†Ø©: " : "ğŸ”¥ Hot: ";
      Object.keys(hotCold).forEach(key => {
        const typeName = getBetName(key, lang);
        const percentage = (hotCold[key] / history.length * 100);
        hotColdText += `<span class="${percentage > 35 ? 'hot' : 'cold'}">${typeName} ${hotCold[key]} (${percentage.toFixed(1)}%)</span> `;
      });

      // Ø§Ù„ØªÙˆØµÙŠØ©
      let recommendation = "";
      if (currentStreak.count >= 3) {
        const typeName = getBetName(currentStreak.type, lang);
        recommendation = isArabic
          ? `ğŸ’¡ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø±Ù‡Ø§Ù† Ø¹Ù„Ù‰ ${typeName}`
          : `ğŸ’¡ Keep betting on ${typeName}`;
      } else if (parseFloat(freqPercent) > 50) {
        const typeName = getBetName(mostFrequent, lang);
        recommendation = isArabic
          ? `ğŸ’¡ Ø±Ù‡Ø§Ù† Ø¢Ù…Ù† Ø¹Ù„Ù‰ ${typeName} (${freqPercent}%)`
          : `ğŸ’¡ Safe bet on ${typeName} (${freqPercent}%)`;
      } else {
        recommendation = isArabic
          ? "ğŸ’¡ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù…Ø· ÙˆØ§Ø¶Ø­ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù…ØªØ­ÙØ¸Ø©"
          : "ğŸ’¡ No clear pattern, use conservative strategy";
      }

      document.getElementById('aiAdvice').innerHTML = `
        ${streakText ? `<div>${streakText}</div>` : ''}
        ${hotColdText ? `<div>${hotColdText}</div>` : ''}
        <div class="probability">${recommendation}</div>
      `;
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø±Ù‡Ø§Ù†
    function getBetName(betType, lang) {
      const names = {
        ar: { P: 'Ø§Ù„Ù„Ø§Ø¹Ø¨', B: 'Ø§Ù„Ù…ØµØ±ÙÙŠ', T: 'ØªØ¹Ø§Ø¯Ù„' },
        en: { P: 'Player', B: 'Banker', T: 'Tie' }
      };
      return lang === 'ar-MA' ? names.ar[betType] : names.en[betType];
    }

    // Ø§Ù„ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù†Øµ
    function speak(text, lang) {
      if ('speechSynthesis' in window) {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = lang;
        speechSynthesis.speak(utter);
      }
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function resetData() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
        history = [];
        balance = 0;
        balanceHistory = [];
        currentStreak = { type: null, count: 0 };
        currentBet = { amount: 0, type: null };
        lastBetResult = null;
        
        updateChart();
        updateAllDisplays();
        saveData();
        
        const lang = document.getElementById('langSelect').value;
        const message = lang === 'ar-MA' ? 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' : 'All data has been reset';
        document.getElementById('predictionResult').textContent = message;
      }
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    window.onload = function() {
      loadData();
      
      // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      document.querySelector('.player').addEventListener('click', function() { addResult('P'); });
      document.querySelector('.banker').addEventListener('click', function() { addResult('B'); });
      document.querySelector('.tie').addEventListener('click', function() { addResult('T'); });
      
      // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
      document.getElementById('langSelect').addEventListener('change', function() {
        updateAllDisplays();
      });
    };
  </script>
</body>
    </html>
