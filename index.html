<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AYOUB BACCARAT PRO - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø©</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
:root{--gold:#d4af37;--gold-2:#b8871d;--bg-dark:#070606;--card:#0f0e10;--muted:#bfb7a6;--player:#2d7ef7;--banker:#e03b3b;--tie:#28a745;}
:root[data-theme="light"]{--gold:#d4af37;--gold-2:#b8871d;--bg-dark:#f5f5f5;--card:#ffffff;--muted:#666666;--player:#2d7ef7;--banker:#e03b3b;--tie:#28a745;}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:Inter,sans-serif;margin:0;background:linear-gradient(180deg,var(--bg-dark),#0b0b0b);color:#fff;padding:18px;transition:background 0.3s, color 0.3s;min-height:100vh;}
:root[data-theme="light"] body{color:#333;}
.app{max-width:1200px;margin:0 auto;width:100%;}
.top{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px;flex-wrap:wrap;}
.logo{font-weight:800;background:linear-gradient(90deg,var(--gold),#fff3b0);color:#000;padding:8px 12px;border-radius:12px;display:inline-block;font-size:1.2rem;}
.subtitle{font-size:14px;color:var(--muted);margin-top:4px;}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.card{background:linear-gradient(180deg,var(--card),#0b0b0b);border-radius:12px;padding:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6);border:1px solid rgba(212,175,55,0.08);margin-bottom:10px;}
:root[data-theme="light"] .card{background:linear-gradient(180deg,var(--card),#f0f0f0);box-shadow:0 8px 30px rgba(0,0,0,0.1);border:1px solid rgba(0,0,0,0.05);}
.layout{display:flex;gap:12px;flex-wrap:wrap;}
.left{width:360px;min-width:300px;display:flex;flex-direction:column;gap:10px;flex:1;}
.right{flex:2;display:flex;flex-direction:column;gap:12px;min-width:300px;}
.panel{padding:10px;}
.row{display:flex;gap:8px;align-items:center;margin-top:8px;}
input[type=number], select{background:rgba(255,255,255,0.1);border:2px solid rgba(255,255,255,0.3);padding:10px;border-radius:8px;color:#fff;font-weight:600;font-size:14px;width:100%;}
:root[data-theme="light"] input[type=number], :root[data-theme="light"] select{background:rgba(255,255,255,0.9);border:2px solid rgba(0,0,0,0.2);color:#333;}
.btn{padding:12px 16px;border-radius:8px;border:0;color:#fff;cursor:pointer;font-weight:600;font-size:16px;transition:all 0.3s;text-align:center;min-width:70px;}
.btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.3);}
.btn:active{transform:translateY(0);}
.btn.gold{background:linear-gradient(90deg,var(--gold),var(--gold-2));color:#000;font-weight:700;box-shadow:0 6px 20px rgba(212,175,55,0.3);}

/* Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ø¶Ø­Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
.btn.player{background:linear-gradient(135deg, #3a86ff, #2667cc); color:white; border:2px solid #3a86ff;}
.btn.banker{background:linear-gradient(135deg, #ff006e, #cc0058); color:white; border:2px solid #ff006e;}
.btn.tie{background:linear-gradient(135deg, #38b000, #2c8a00); color:white; border:2px solid #38b000;}

/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ */
:root[data-theme="light"] .btn.player{background:linear-gradient(135deg, #2d7ef7, #1a67d8); color:white;}
:root[data-theme="light"] .btn.banker{background:linear-gradient(135deg, #e03b3b, #c53232); color:white;}
:root[data-theme="light"] .btn.tie{background:linear-gradient(135deg, #28a745, #218838); color:white;}

:root[data-theme="light"] .btn{background:rgba(0,0,0,0.1);color:#333; border:1px solid rgba(0,0,0,0.1)}

.small{font-size:13px;color:var(--muted);}
.muted{color:var(--muted);font-size:12px;}
.pattern-list{list-style:none;padding:6px;margin:6px 0 0 0;max-height:200px;overflow:auto;}
.pattern-list li{padding:8px;border-radius:8px;margin-bottom:6px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);display:flex;justify-content:space-between;align-items:center;}
:root[data-theme="light"] .pattern-list li{background:linear-gradient(180deg,rgba(0,0,0,0.02),transparent);}
.section-title{font-weight:700;margin-bottom:6px;color:var(--gold);font-size:1.1rem;}
.stat-table{width:100%;border-collapse:collapse;font-size:13px;}
.stat-table th,.stat-table td{border:1px solid rgba(255,255,255,0.05);padding:6px;text-align:center;}
:root[data-theme="light"] .stat-table th, :root[data-theme="light"] .stat-table td{border:1px solid rgba(0,0,0,0.05);}
.stat-table th{background:rgba(212,175,55,0.1);font-weight:600;}
.player{color:#3a86ff;font-weight:700;}
.banker{color:#ff006e;font-weight:700;}
.tie{color:#38b000;font-weight:700;}
.pred-head{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;}
.final{font-size:22px;font-weight:800;text-align:center;padding:12px;background:linear-gradient(90deg,rgba(212,175,55,0.06),transparent);border-radius:10px;margin:10px 0;}
:root[data-theme="light"] .final{background:linear-gradient(90deg,rgba(212,175,55,0.1),transparent);}
.foot{display:flex;justify-content:space-between;align-items:center;margin-top:14px;flex-wrap:wrap;gap:10px;}
.credits{opacity:0.85;font-size:12px;}
canvas{border-radius:10px;background:#0f0e10;width:100% !important;height:auto !important;max-height:450px;}
:root[data-theme="light"] canvas{background:#f0f0f0;}
.color-legend{display:flex;gap:15px;justify-content:center;margin-bottom:10px;font-size:14px;flex-wrap:wrap;}
.color-legend span{padding:4px 8px;border-radius:6px; font-weight:600;}
.prediction-cards{display:flex;gap:10px;justify-content:center;margin:10px 0;flex-wrap:wrap;}
.pred-card{padding:10px;border-radius:8px;text-align:center;min-width:80px; font-weight:600;flex:1;}
.pred-card.active{transform:scale(1.05);border:2px solid var(--gold); box-shadow:0 4px 15px rgba(212,175,55,0.4);}
.win-effect{animation:winPulse 0.5s ease-in-out;}
.loss-effect{animation:lossShake 0.5s ease-in-out;}
@keyframes winPulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}
@keyframes lossShake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.analysis-result{margin-top:10px;padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;text-align:center;}
:root[data-theme="light"] .analysis-result{background:rgba(0,0,0,0.03);}
.theme-toggle{background:transparent;border:none;font-size:24px;cursor:pointer;padding:5px;border-radius:50%;transition:background 0.3s;width:40px;height:40px;display:flex;align-items:center;justify-content:center;}
.theme-toggle:hover{background:rgba(255,255,255,0.1);}
:root[data-theme="light"] .theme-toggle:hover{background:rgba(0,0,0,0.05);}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
.input-group {display: flex; gap: 8px; align-items:center;}
.input-group input {flex: 1;}
.input-label {font-weight: 600; margin-bottom: 6px; display: block;}

/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
.pred-card.player {background: linear-gradient(135deg, #3a86ff, #2667cc); color: white;}
.pred-card.banker {background: linear-gradient(135deg, #ff006e, #cc0058); color: white;}
.pred-card.tie {background: linear-gradient(135deg, #38b000, #2c8a00); color: white;}

/* ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ */
.stage-indicator {padding: 6px 12px; border-radius: 20px; font-weight: 600; font-size: 12px;}
.stage-early {background: rgba(59, 130, 246, 0.2); color: #3a86ff; border: 1px solid #3a86ff;}
.stage-mid {background: rgba(212, 175, 55, 0.2); color: #d4af37; border: 1px solid #d4af37;}
.stage-late {background: rgba(56, 176, 0, 0.2); color: #38b000; border: 1px solid #38b000;}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© */
.micro-patterns {display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; margin-top: 10px;}
.micro-pattern {background: rgba(255,255,255,0.03); padding: 8px; border-radius: 6px; text-align: center; font-family: monospace; font-size: 14px;}
.micro-pattern.high-confidence {border: 2px solid #38b000;}
.micro-pattern.medium-confidence {border: 2px solid #d4af37;}
.confidence-meter {height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 8px; overflow: hidden; width: 100%;}
.confidence-fill {height: 100%; background: linear-gradient(90deg, #38b000, #ff006e); border-radius: 4px; transition: width 0.3s ease;}
.table-momentum {padding: 10px; border-radius: 8px; background: rgba(59, 130, 246, 0.05); margin-top: 10px;}
.momentum-indicator {display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 6px;}
.momentum-up {background: #38b000;}
.momentum-down {background: #ff006e;}
.momentum-stable {background: #d4af37;}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
@media (max-width: 768px) {
    .layout {flex-direction: column;}
    .left, .right {width: 100%;}
    .top {flex-direction: column; align-items: flex-start;}
    .controls {width: 100%; justify-content: space-between;}
    .prediction-cards {flex-direction: column;}
    .pred-card {width: 100%;}
    .row {flex-wrap: wrap;}
    .btn {flex: 1; min-width: 60px;}
}

@media (max-width: 480px) {
    body {padding: 10px;}
    .card {padding: 8px;}
    .btn {padding: 10px 12px; font-size: 14px;}
}
</style>
</head>
<body>
<div class="app">
<header class="top card">
  <div class="brand">
    <div class="logo">AYOUB BACCARAT PRO <span class="stage-indicator stage-early" id="tableStage">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: Ù…Ø¨ÙƒØ±Ø©</span></div>
    <div class="subtitle">Ù†Ø¸Ø§Ù… ØªÙ†Ø¨Ø¤ Ù…ØªØ·ÙˆØ± Ù„Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø© (70-80 Ø¬ÙˆÙ„Ø©) ğŸ¯ğŸ“Š</div>
  </div>
  <div class="controls">
    <button id="themeToggle" class="theme-toggle" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">ğŸŒš</button>
    <button id="btnReset" class="btn gold">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
  </div>
</header>

<main class="layout">
<aside class="left">
  <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§ÙˆÙ„Ø© -->
  <div class="panel card">
    <div class="section-title">ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</div>
    <div class="row">
      <div style="flex: 1;">
        <div class="muted small">Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
        <div class="final" style="font-size: 28px; padding: 5px;" id="currentRound">0</div>
      </div>
      <div style="flex: 1;">
        <div class="muted small">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</div>
        <div id="stageInfo" style="font-weight: 700; text-align: center;">â€”</div>
      </div>
    </div>
    <div class="table-momentum">
      <div class="muted small">Ø²Ø®Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</div>
      <div id="momentumIndicator">
        <span class="momentum-indicator momentum-stable"></span>
        <span>Ù…Ø³ØªÙ‚Ø±</span>
      </div>
    </div>
  </div>

  <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ù‚ØµÙŠØ±Ø© -->
  <div class="panel card">
    <div class="section-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ù‚ØµÙŠØ±Ø©</div>
    <div class="row">
      <label class="input-label">Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø¨ÙƒØ±Ø©</label>
      <input id="earlyWindow" type="number" min="3" max="10" value="5">
    </div>
    <div class="row">
      <label class="input-label">Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©</label>
      <input id="lateWindow" type="number" min="5" max="15" value="8">
    </div>
    <div class="row">
      <button id="applySettings" class="btn gold" style="flex: 1;">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </div>
    <div class="muted small" style="margin-top: 8px;">Ù…Ø®ØµØµ Ù„Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ù…Ù† 70-80 Ø¬ÙˆÙ„Ø©</div>
  </div>

  <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
  <div class="panel card">
    <div class="section-title">ğŸ® Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div>
    <div class="row">
      <button class="btn player" id="btnP">Ù„Ø§Ø¹Ø¨ ğŸ”µ</button>
      <button class="btn banker" id="btnB">Ù…ØµØ±ÙÙŠ ğŸ”´</button>
      <button class="btn tie" id="btnT">ØªØ¹Ø§Ø¯Ù„ ğŸŸ¢</button>
    </div>
    <div class="row">
      <button class="btn" id="btnUndo" style="flex:1; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2)">ØªØ±Ø§Ø¬Ø¹</button>
      <button class="btn" id="btnQuick5" style="flex:1; background:rgba(212,175,55,0.1); border:1px solid rgba(212,175,55,0.3)">+5 Ø¬ÙˆÙ„Ø§Øª</button>
    </div>
    <div class="muted small" style="margin-top: 8px; text-align: center;">
      Ø£Ø¯Ø®Ù„ Ù†ØªÙŠØ¬Ø© ÙƒÙ„ Ø¬ÙˆÙ„Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
    </div>
  </div>

  <!-- Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…ØµØºØ±Ø© -->
  <div class="panel card">
    <div class="section-title">ğŸ” Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…ØµØºØ±Ø© Ø§Ù„Ù…ÙƒØªØ´ÙØ©</div>
    <div class="micro-patterns" id="microPatterns">
      <div class="muted small" style="grid-column: 1/-1; text-align: center;">Ø£Ø¯Ø®Ù„ 3 Ø¬ÙˆÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</div>
    </div>
    <div class="muted small" style="margin-top: 8px;">Ø£Ù†Ù…Ø§Ø· Ù…Ù† 2-3 Ø¬ÙˆÙ„Ø§Øª Ù…Ø¹ Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„ØªÙƒØ±Ø§Ø±</div>
  </div>

  <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø±Ø­Ù„Ø© -->
  <div class="panel card">
    <div class="section-title">ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø±Ø­Ù„Ø©</div>
    <table class="stat-table">
      <thead>
        <tr><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>ğŸ”µ Ù„Ø§Ø¹Ø¨</th><th>ğŸ”´ Ù…ØµØ±ÙÙŠ</th><th>ğŸŸ¢ ØªØ¹Ø§Ø¯Ù„</th><th>Ø§Ù„Ø¯Ù‚Ø©</th></tr>
      </thead>
      <tbody>
        <tr><td>Ù…Ø¨ÙƒØ±Ø©</td><td id="earlyP">0</td><td id="earlyB">0</td><td id="earlyT">0</td><td id="earlyAcc">0%</td></tr>
        <tr><td>ÙˆØ³Ø·Ù‰</td><td id="midP">0</td><td id="midB">0</td><td id="midT">0</td><td id="midAcc">0%</td></tr>
        <tr><td>Ù…ØªØ£Ø®Ø±Ø©</td><td id="lateP">0</td><td id="lateB">0</td><td id="lateT">0</td><td id="lateAcc">0%</td></tr>
      </tbody>
    </table>
  </div>
</aside>

<section class="right">
  <!-- Ø§Ù„ØªÙ†Ø¨Ø¤ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <div class="card prediction">
    <div class="pred-head">
      <div class="pred-title">ğŸ¯ ØªÙ†Ø¨Ø¤ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</div>
      <div class="pred-sub" id="predictionStrategy">Ù†Ø¸Ø§Ù… ØªØ­Ù„ÙŠÙ„ Ù…Ø±Ø­Ù„ÙŠ Ù„Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø©</div>
    </div>

    <div class="color-legend">
      <span style="background:linear-gradient(135deg, #3a86ff, #2667cc);">ğŸ”µ Ù„Ø§Ø¹Ø¨</span>
      <span style="background:linear-gradient(135deg, #ff006e, #cc0058);">ğŸ”´ Ù…ØµØ±ÙÙŠ</span>
      <span style="background:linear-gradient(135deg, #38b000, #2c8a00);">ğŸŸ¢ ØªØ¹Ø§Ø¯Ù„</span>
    </div>
    
    <!-- Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„ÙƒØ¨ÙŠØ± -->
    <canvas id="bigRoad" width="800" height="300"></canvas>

    <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªÙ†Ø¨Ø¤ -->
    <div class="prediction-cards">
      <div class="pred-card player" id="predP">
        <div>Ù„Ø§Ø¹Ø¨</div>
        <div id="predPctP">0%</div>
        <div class="muted small" id="predTrendP">â†’</div>
        <div class="confidence-meter">
          <div class="confidence-fill" id="confidenceP" style="width: 0%"></div>
        </div>
      </div>
      <div class="pred-card banker" id="predB">
        <div>Ù…ØµØ±ÙÙŠ</div>
        <div id="predPctB">0%</div>
        <div class="muted small" id="predTrendB">â†’</div>
        <div class="confidence-meter">
          <div class="confidence-fill" id="confidenceB" style="width: 0%"></div>
        </div>
      </div>
      <div class="pred-card tie" id="predT">
        <div>ØªØ¹Ø§Ø¯Ù„</div>
        <div id="predPctT">0%</div>
        <div class="muted small" id="predTrendT">â†’</div>
        <div class="confidence-meter">
          <div class="confidence-fill" id="confidenceT" style="width: 0%"></div>
        </div>
      </div>
    </div>

    <!-- Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ -->
    <div class="analysis-result">
      <div class="muted">Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ:</div>
      <div class="final" id="finalCard">â€”</div>
      <div class="muted small" id="predictionReason">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ù„ØªØ­Ù„ÙŠÙ„</div>
      <div class="muted small" id="stageRecommendation" style="margin-top: 8px; color: var(--gold); font-weight: 600;"></div>
    </div>
  </div>

  <!-- ØªØ­Ù„ÙŠÙ„ ØªÙØµÙŠÙ„ÙŠ -->
  <div class="panel card">
    <div class="section-title">ğŸ“Š ØªØ­Ù„ÙŠÙ„ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø·Ø§ÙˆÙ„Ø©</div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">
      <div style="background: rgba(59,130,246,0.1); padding: 10px; border-radius: 8px;">
        <div class="muted small">Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙƒÙ„ÙŠ</div>
        <div style="font-weight: 700; font-size: 18px;" id="totalDist">0-0-0</div>
      </div>
      <div style="background: rgba(255,0,110,0.1); padding: 10px; border-radius: 8px;">
        <div class="muted small">Ø£Ø·ÙˆÙ„ Ø³Ù„Ø³Ù„Ø©</div>
        <div style="font-weight: 700; font-size: 18px;" id="longestStreak">0</div>
      </div>
      <div style="background: rgba(56,176,0,0.1); padding: 10px; border-radius: 8px;">
        <div class="muted small">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†Ø§ÙˆØ¨</div>
        <div style="font-weight: 700; font-size: 18px;" id="alternationRate">0%</div>
      </div>
      <div style="background: rgba(212,175,55,0.1); padding: 10px; border-radius: 8px;">
        <div class="muted small">Ø«Ù‚Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</div>
        <div style="font-weight: 700; font-size: 18px;" id="systemConfidence">0%</div>
      </div>
    </div>
    
    <!-- Ù…Ø®Ø·Ø· Ø§Ù„ØªÙˆØ²ÙŠØ¹ -->
    <div style="margin-top: 15px;">
      <div class="muted small">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</div>
      <div style="display: flex; height: 30px; border-radius: 6px; overflow: hidden; margin-top: 5px;">
        <div id="distPlayer" style="background: #3a86ff; transition: width 0.3s;"></div>
        <div id="distBanker" style="background: #ff006e; transition: width 0.3s;"></div>
        <div id="distTie" style="background: #38b000; transition: width 0.3s;"></div>
      </div>
      <div style="display: flex; justify-content: space-between; font-size: 11px; margin-top: 5px;">
        <span style="color: #3a86ff;">Ù„Ø§Ø¹Ø¨</span>
        <span style="color: #ff006e;">Ù…ØµØ±ÙÙŠ</span>
        <span style="color: #38b000;">ØªØ¹Ø§Ø¯Ù„</span>
      </div>
    </div>
  </div>

  <!-- Ø£Ù†Ù…Ø§Ø· Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø·Ø§ÙˆÙ„Ø© -->
  <div class="panel card">
    <div class="section-title">ğŸ¯ Ø£Ù†Ù…Ø§Ø· Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</div>
    <div class="row">
      <div style="flex: 1; text-align: center;">
        <div class="muted small">Ø¢Ø®Ø± 10 Ø¬ÙˆÙ„Ø§Øª</div>
        <div id="last10Pattern" style="font-family: monospace; font-size: 16px; letter-spacing: 2px;">â€”â€”â€”</div>
      </div>
      <div style="flex: 1; text-align: center;">
        <div class="muted small">Ù†Ù…Ø· Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</div>
        <div id="closingPattern" style="font-weight: 700;">â€”</div>
      </div>
    </div>
    <div class="muted small" style="margin-top: 10px;">
      <span id="closingAdvice">Ø§Ù„Ø·Ø§ÙˆÙ„Ø© ÙÙŠ Ø¨Ø¯Ø§ÙŠØªÙ‡Ø§ - Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</span>
    </div>
  </div>
</section>
</main>

<footer class="foot card">
  <div style="flex: 1;">
    <div>AYOUB BACCARAT PRO - Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø©</div>
    <div class="credits small">ØªØ­Ù„ÙŠÙ„ Ù…Ø±Ø­Ù„ÙŠ â€¢ Ø£Ù†Ù…Ø§Ø· Ù…ØµØºØ±Ø© â€¢ ØªÙˆÙ‚Ø¹ Ù†Ù‡Ø§ÙŠØ§Øª â€¢ Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ</div>
  </div>
  <div class="data-controls">
    <button id="btnExport" class="btn" style="background: rgba(59, 130, 246, 0.2); border: 1px solid #3a86ff;">ğŸ“¥ ØªØµØ¯ÙŠØ±</button>
    <button id="btnImport" class="btn" style="background: rgba(16, 185, 129, 0.2); border: 1px solid #10b981;">ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
    <button id="btnClearData" class="btn" style="background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444;">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
  </div>
  <div class="muted small" style="text-align: center; width: 100%; margin-top: 10px;">
    <span id="autoSaveStatus">ğŸ’¾ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù„</span> â€¢ 
    <span id="dataStats">0 Ø¬ÙˆÙ„Ø© â€¢ 0 Ù†Ù…Ø·</span>
  </div>
</footer>
</div>

<script>
// ========== Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø© ==========

const state = {
  rounds: [],
  stage: 'early', // early, mid, late
  settings: {
    earlyWindow: 5,
    lateWindow: 8,
    totalTableRounds: 73 // Ù…ØªÙˆØ³Ø· Ø§Ù„Ø·Ø§ÙˆÙ„Ø©
  },
  statistics: {
    early: { P: 0, B: 0, T: 0, correct: 0, total: 0 },
    mid: { P: 0, B: 0, T: 0, correct: 0, total: 0 },
    late: { P: 0, B: 0, T: 0, correct: 0, total: 0 }
  },
  microPatterns: {},
  closingPatterns: [],
  predictionsHistory: [],
  currentPrediction: null,
  tableMomentum: 'stable'
};

// ========== Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ ==========

class ShortTableAnalyzer {
  constructor() {
    this.patternMemory = new Map();
  }
  
  determineStage(rounds) {
    const total = rounds.length;
    const totalExpected = state.settings.totalTableRounds;
    
    if (total <= 20) return 'early';
    if (total <= 50) return 'mid';
    if (total <= totalExpected) return 'late';
    return 'extended';
  }
  
  analyzeStage(rounds, stage) {
    const analysis = {
      distribution: { P: 0, B: 0, T: 0 },
      streaks: [],
      alternationRate: 0,
      momentum: 'stable',
      confidence: 0
    };
    
    if (rounds.length === 0) return analysis;
    
    // Ø§Ù„ØªÙˆØ²ÙŠØ¹
    analysis.distribution.P = rounds.filter(r => r === 'P').length / rounds.length;
    analysis.distribution.B = rounds.filter(r => r === 'B').length / rounds.length;
    analysis.distribution.T = rounds.filter(r => r === 'T').length / rounds.length;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ù„Ø§Ø³Ù„
    analysis.streaks = this.findStreaks(rounds);
    
    // Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†Ø§ÙˆØ¨
    analysis.alternationRate = this.calculateAlternationRate(rounds);
    
    // Ø²Ø®Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©
    analysis.momentum = this.calculateMomentum(rounds);
    
    // Ø§Ù„Ø«Ù‚Ø©
    analysis.confidence = this.calculateStageConfidence(rounds, stage);
    
    return analysis;
  }
  
  findStreaks(rounds) {
    const streaks = [];
    let current = { type: null, length: 0 };
    
    for (const round of rounds) {
      if (current.type === round) {
        current.length++;
      } else {
        if (current.type) {
          streaks.push({ ...current });
        }
        current = { type: round, length: 1 };
      }
    }
    
    if (current.type) {
      streaks.push({ ...current });
    }
    
    return streaks;
  }
  
  calculateAlternationRate(rounds) {
    if (rounds.length < 2) return 0;
    
    let changes = 0;
    for (let i = 1; i < rounds.length; i++) {
      if (rounds[i] !== rounds[i-1]) changes++;
    }
    
    return changes / (rounds.length - 1);
  }
  
  calculateMomentum(rounds) {
    if (rounds.length < 10) return 'stable';
    
    const firstHalf = rounds.slice(0, Math.floor(rounds.length / 2));
    const secondHalf = rounds.slice(Math.floor(rounds.length / 2));
    
    const volatilityFirst = this.calculateAlternationRate(firstHalf);
    const volatilitySecond = this.calculateAlternationRate(secondHalf);
    
    const diff = volatilitySecond - volatilityFirst;
    
    if (diff > 0.2) return 'volatile';
    if (diff < -0.2) return 'calm';
    return 'stable';
  }
  
  calculateStageConfidence(rounds, stage) {
    if (rounds.length < 3) return 0;
    
    let confidence = 0;
    
    switch(stage) {
      case 'early':
        confidence = Math.min(70, rounds.length * 3);
        break;
      case 'mid':
        const consistency = this.calculateConsistency(rounds.slice(-15));
        confidence = 40 + (consistency * 40);
        break;
      case 'late':
        const patternStrength = this.analyzeClosingPatterns(rounds.slice(-10));
        confidence = 50 + (patternStrength * 50);
        break;
    }
    
    return Math.min(95, Math.max(5, confidence));
  }
  
  calculateConsistency(rounds) {
    if (rounds.length < 2) return 0;
    
    const type = rounds[0];
    const sameCount = rounds.filter(r => r === type).length;
    return sameCount / rounds.length;
  }
  
  analyzeClosingPatterns(rounds) {
    if (rounds.length < 5) return 0;
    
    // ØªØ­Ù„ÙŠÙ„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
    const patterns = [
      { pattern: ['P','B','P','B'], strength: 0.6 },
      { pattern: ['B','B','B'], strength: 0.7 },
      { pattern: ['P','P','P'], strength: 0.7 },
      { pattern: ['P','B','T'], strength: 0.4 }
    ];
    
    let maxStrength = 0;
    
    for (const p of patterns) {
      if (rounds.length >= p.pattern.length) {
        const recent = rounds.slice(-p.pattern.length);
        const match = recent.every((r, i) => r === p.pattern[i]);
        if (match) {
          maxStrength = Math.max(maxStrength, p.strength);
        }
      }
    }
    
    return maxStrength;
  }
  
  // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…ØµØºØ±Ø© (2-3 Ø¬ÙˆÙ„Ø§Øª)
  findMicroPatterns(rounds) {
    const patterns = {};
    
    // Ø£Ù†Ù…Ø§Ø· Ø·ÙˆÙ„ 2
    for (let i = 0; i < rounds.length - 1; i++) {
      const pattern = rounds.slice(i, i + 2).join('');
      const next = rounds[i + 2];
      
      if (!patterns[pattern]) {
        patterns[pattern] = { P: 0, B: 0, T: 0, total: 0 };
      }
      
      if (next && next in patterns[pattern]) {
        patterns[pattern][next]++;
        patterns[pattern].total++;
      }
    }
    
    // Ø£Ù†Ù…Ø§Ø· Ø·ÙˆÙ„ 3
    for (let i = 0; i < rounds.length - 2; i++) {
      const pattern = rounds.slice(i, i + 3).join('');
      const next = rounds[i + 3];
      
      if (!patterns[pattern]) {
        patterns[pattern] = { P: 0, B: 0, T: 0, total: 0 };
      }
      
      if (next && next in patterns[pattern]) {
        patterns[pattern][next]++;
        patterns[pattern].total++;
      }
    }
    
    return patterns;
  }
  
  // Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø­Ù„Ø©
  predictByStage(rounds, stage) {
    const totalRounds = rounds.length;
    
    if (totalRounds < 3) {
      return this.getInitialPrediction();
    }
    
    let prediction = { P: 33.3, B: 33.3, T: 33.3 };
    
    switch(stage) {
      case 'early':
        prediction = this.predictEarlyStage(rounds);
        break;
      case 'mid':
        prediction = this.predictMidStage(rounds);
        break;
      case 'late':
        prediction = this.predictLateStage(rounds);
        break;
    }
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…ØµØºØ±Ø©
    const microPatternBoost = this.applyMicroPatterns(rounds);
    
    // Ø¯Ù…Ø¬ Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª
    const finalPrediction = {
      P: (prediction.P * 0.7 + microPatternBoost.P * 0.3),
      B: (prediction.B * 0.7 + microPatternBoost.B * 0.3),
      T: (prediction.T * 0.7 + microPatternBoost.T * 0.3)
    };
    
    // ØªØ·Ø¨ÙŠØ¹
    const sum = finalPrediction.P + finalPrediction.B + finalPrediction.T;
    if (sum > 0) {
      finalPrediction.P = (finalPrediction.P / sum) * 100;
      finalPrediction.B = (finalPrediction.B / sum) * 100;
      finalPrediction.T = (finalPrediction.T / sum) * 100;
    }
    
    return finalPrediction;
  }
  
  getInitialPrediction() {
    // Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø±ÙŠØ© Ù„Ù„Ø¨Ø§ÙƒØ§Ø±Ø§Øª
    return { P: 44.6, B: 45.8, T: 9.6 };
  }
  
  predictEarlyStage(rounds) {
    const recent = rounds.slice(-state.settings.earlyWindow);
    const distribution = this.analyzeStage(recent, 'early').distribution;
    
    // ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŒ Ù†Ù…ÙŠÙ„ Ù†Ø­Ùˆ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ©
    const lastType = rounds[rounds.length - 1];
    let prediction = { ...distribution };
    
    // ØªØ¹Ø²ÙŠØ² Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø£Ø®ÙŠØ±
    if (lastType && distribution[lastType] > 0.4) {
      prediction[lastType] *= 1.3;
    }
    
    return prediction;
  }
  
  predictMidStage(rounds) {
    const recent = rounds.slice(-15);
    const analysis = this.analyzeStage(recent, 'mid');
    
    let prediction = { P: 0, B: 0, T: 0 };
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù…ØªÙ‚Ù„Ø¨Ø©
    if (analysis.momentum === 'volatile') {
      // Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø¹ÙƒØ³ Ø§Ù„Ø£Ø®ÙŠØ±
      const lastType = rounds[rounds.length - 1];
      prediction[lastType === 'P' ? 'B' : 'P'] = 60;
      prediction[lastType === 'P' ? 'P' : 'B'] = 35;
      prediction.T = 5;
    } 
    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ø§Ø¯Ø¦Ø©
    else if (analysis.momentum === 'calm') {
      // Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ©
      const lastType = rounds[rounds.length - 1];
      prediction[lastType] = 65;
      prediction[lastType === 'P' ? 'B' : 'P'] = 30;
      prediction.T = 5;
    }
    // Ù…Ø³ØªÙ‚Ø±Ø©
    else {
      prediction = analysis.distribution;
    }
    
    return prediction;
  }
  
  predictLateStage(rounds) {
    const last10 = rounds.slice(-10);
    const closingPattern = this.analyzeClosingPatterns(last10);
    
    if (closingPattern > 0.5) {
      // Ù†Ù…Ø· Ø¥ØºÙ„Ø§Ù‚ Ù‚ÙˆÙŠ
      const lastType = rounds[rounds.length - 1];
      return { 
        P: lastType === 'P' ? 70 : 15, 
        B: lastType === 'B' ? 70 : 15, 
        T: 15 
      };
    }
    
    // Ø¨Ø¯ÙˆÙ† Ù†Ù…Ø· ÙˆØ§Ø¶Ø­ØŒ Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ²ÙŠØ¹
    const distribution = this.analyzeStage(rounds, 'late').distribution;
    
    // ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŒ Ù†Ø­Ø§ÙˆÙ„ Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø§ØªØ¬Ø§Ù‡
    const trend = this.detectTrend(rounds.slice(-20));
    if (trend.strength > 0.6) {
      distribution[trend.direction] *= 1.4;
    }
    
    return distribution;
  }
  
  detectTrend(rounds) {
    if (rounds.length < 5) return { direction: null, strength: 0 };
    
    const pCount = rounds.filter(r => r === 'P').length;
    const bCount = rounds.filter(r => r === 'B').length;
    
    const total = rounds.length;
    const pRatio = pCount / total;
    const bRatio = bCount / total;
    
    const diff = Math.abs(pRatio - bRatio);
    
    if (diff < 0.1) return { direction: null, strength: 0 };
    
    return {
      direction: pRatio > bRatio ? 'P' : 'B',
      strength: diff
    };
  }
  
  applyMicroPatterns(rounds) {
    const patterns = this.findMicroPatterns(rounds);
    const lastPattern2 = rounds.length >= 2 ? rounds.slice(-2).join('') : null;
    const lastPattern3 = rounds.length >= 3 ? rounds.slice(-3).join('') : null;
    
    let prediction = { P: 0, B: 0, T: 0 };
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø£Ù†Ù…Ø§Ø· Ø·ÙˆÙ„ 2
    if (lastPattern2 && patterns[lastPattern2] && patterns[lastPattern2].total > 0) {
      const pattern = patterns[lastPattern2];
      prediction.P += (pattern.P / pattern.total) * 50;
      prediction.B += (pattern.B / pattern.total) * 50;
      prediction.T += (pattern.T / pattern.total) * 50;
    }
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø£Ù†Ù…Ø§Ø· Ø·ÙˆÙ„ 3
    if (lastPattern3 && patterns[lastPattern3] && patterns[lastPattern3].total > 0) {
      const pattern = patterns[lastPattern3];
      prediction.P += (pattern.P / pattern.total) * 50;
      prediction.B += (pattern.B / pattern.total) * 50;
      prediction.T += (pattern.T / pattern.total) * 50;
    }
    
    // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø£Ù†Ù…Ø§Ø·
    if (prediction.P + prediction.B + prediction.T === 0) {
      prediction = { P: 33.3, B: 33.3, T: 33.3 };
    }
    
    return prediction;
  }
  
  getStageRecommendation(stage) {
    const recommendations = {
      early: "ğŸ” Ø±ÙƒØ² Ø¹Ù„Ù‰ ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©. ØºØ§Ù„Ø¨Ø§Ù‹ Ù…Ø§ ØªØ³ØªÙ…Ø± Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø¨ÙƒØ±Ø©.",
      mid: "âš–ï¸ Ù‡Ø°Ù‡ Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙ†Ø§ÙˆØ¨. Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ù†Ù…Ø§Ø· Ù…Ù†ØªØ¸Ù…Ø© Ø¨ÙŠÙ† Ù„Ø§Ø¹Ø¨ ÙˆÙ…ØµØ±ÙÙŠ.",
      late: "ğŸ¯ Ø§Ù†ØªØ¨Ù‡ Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø·Ø§ÙˆÙ„Ø©. ØºØ§Ù„Ø¨Ø§Ù‹ Ù…Ø§ ØªÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø£Ù†Ù…Ø§Ø· Ø¥ØºÙ„Ø§Ù‚ Ù…Ù…ÙŠØ²Ø©."
    };
    
    return recommendations[stage] || "Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„ØªØ­Ù„ÙŠÙ„ Ø£ÙØ¶Ù„.";
  }
}

// ========== Ù…Ø¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========

class DataManager {
  constructor() {
    this.storageKey = 'baccarat_short_table_v2';
  }
  
  save() {
    try {
      const data = {
        rounds: state.rounds,
        settings: state.settings,
        statistics: state.statistics,
        predictionsHistory: state.predictionsHistory,
        version: '2.0',
        lastSave: new Date().toISOString()
      };
      
      localStorage.setItem(this.storageKey, JSON.stringify(data));
      this.updateSaveStatus(true);
      return true;
    } catch (e) {
      console.error('Error saving data:', e);
      this.updateSaveStatus(false);
      return false;
    }
  }
  
  load() {
    try {
      const saved = localStorage.getItem(this.storageKey);
      if (!saved) return false;
      
      const data = JSON.parse(saved);
      
      state.rounds = data.rounds || [];
      state.settings = data.settings || state.settings;
      state.statistics = data.statistics || state.statistics;
      state.predictionsHistory = data.predictionsHistory || [];
      
      this.updateSaveStatus(true, 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      return true;
    } catch (e) {
      console.error('Error loading data:', e);
      return false;
    }
  }
  
  exportData() {
    try {
      const data = {
        rounds: state.rounds,
        statistics: state.statistics,
        totalRounds: state.rounds.length,
        exportDate: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `baccarat_short_table_${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast(`âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${state.rounds.length} Ø¬ÙˆÙ„Ø©`);
    } catch (e) {
      showToast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±', 'error');
    }
  }
  
  importData(file) {
    const reader = new FileReader();
    
    reader.onload = (e) => {
      try {
        const data = JSON.parse(e.target.result);
        
        if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${data.rounds?.length || 0} Ø¬ÙˆÙ„Ø©ØŸ`)) {
          return;
        }
        
        state.rounds = data.rounds || [];
        state.statistics = data.statistics || state.statistics;
        
        updateAll();
        this.save();
        showToast(`âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${state.rounds.length} Ø¬ÙˆÙ„Ø©`);
      } catch (error) {
        showToast('âŒ Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­', 'error');
      }
    };
    
    reader.readAsText(file);
  }
  
  clearData() {
    if (confirm('âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
      localStorage.removeItem(this.storageKey);
      state.rounds = [];
      state.statistics = {
        early: { P: 0, B: 0, T: 0, correct: 0, total: 0 },
        mid: { P: 0, B: 0, T: 0, correct: 0, total: 0 },
        late: { P: 0, B: 0, T: 0, correct: 0, total: 0 }
      };
      state.predictionsHistory = [];
      updateAll();
      showToast('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
  }
  
  updateSaveStatus(success, message = '') {
    const statusEl = document.getElementById('autoSaveStatus');
    if (statusEl) {
      if (success) {
        statusEl.textContent = message || 'ğŸ’¾ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù„';
        statusEl.style.color = '#38b000';
      } else {
        statusEl.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸';
        statusEl.style.color = '#ff006e';
      }
    }
  }
}

// ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ==========

const analyzer = new ShortTableAnalyzer();
const dataManager = new DataManager();

// Ø¹Ù†Ø§ØµØ± DOM
const el = id => document.getElementById(id);

function init() {
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  dataManager.load();
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  el('earlyWindow').value = state.settings.earlyWindow;
  el('lateWindow').value = state.settings.lateWindow;
  
  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
  setupEventListeners();
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  updateAll();
  
  // Ø¨Ø¯Ø¡ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
  setInterval(() => {
    if (state.rounds.length > 0) {
      dataManager.save();
    }
  }, 30000);
  
  showToast('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø© (70-80 Ø¬ÙˆÙ„Ø©)');
}

function setupEventListeners() {
  // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
  el('btnP').onclick = () => pushRound('P');
  el('btnB').onclick = () => pushRound('B');
  el('btnT').onclick = () => pushRound('T');
  el('btnUndo').onclick = undoRound;
  el('btnQuick5').onclick = addQuickRounds;
  
  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  el('applySettings').onclick = applySettings;
  
  // Ø¨ÙŠØ§Ù†Ø§Øª
  el('btnExport').onclick = () => dataManager.exportData();
  el('btnImport').onclick = () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = (e) => {
      if (e.target.files[0]) dataManager.importData(e.target.files[0]);
    };
    input.click();
  };
  el('btnClearData').onclick = () => dataManager.clearData();
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
  el('btnReset').onclick = resetAll;
  
  // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹
  el('themeToggle').onclick = toggleTheme;
}

function applySettings() {
  const early = parseInt(el('earlyWindow').value);
  const late = parseInt(el('lateWindow').value);
  
  if (early >= 3 && early <= 10 && late >= 5 && late <= 15) {
    state.settings.earlyWindow = early;
    state.settings.lateWindow = late;
    updateAll();
    showToast('âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©');
  } else {
    showToast('âŒ Ù‚ÙŠÙ… ØºÙŠØ± ØµØ§Ù„Ø­Ø©', 'error');
  }
}

function pushRound(type) {
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±Ø­Ù„Ø©
  state.stage = analyzer.determineStage(state.rounds);
  
  // Ø­ÙØ¸ Ø§Ù„ØªÙ†Ø¨Ø¤ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡
  const previousPrediction = state.currentPrediction;
  
  // Ø¥Ù†Ø´Ø§Ø¡ ØªÙ†Ø¨Ø¤ Ø¬Ø¯ÙŠØ¯
  const prediction = analyzer.predictByStage(state.rounds, state.stage);
  state.currentPrediction = prediction;
  
  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬ÙˆÙ„Ø©
  state.rounds.push(type);
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø±Ø­Ù„ÙŠØ©
  updateStageStatistics(type);
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙ†Ø¨Ø¤ Ø§Ù„Ø³Ø§Ø¨Ù‚
  if (previousPrediction) {
    const predictedType = getPredictedType(previousPrediction);
    if (predictedType === type) {
      state.statistics[state.stage].correct++;
    }
    state.statistics[state.stage].total++;
    
    // Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®
    state.predictionsHistory.push({
      round: state.rounds.length,
      predicted: predictedType,
      actual: type,
      correct: predictedType === type,
      stage: state.stage
    });
  }
  
  // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø´ÙŠØ¡
  updateAll();
  dataManager.save();
  
  // ØªØ£Ø«ÙŠØ± Ù…Ø±Ø¦ÙŠ
  showRoundEffect(type);
}

function getPredictedType(prediction) {
  const entries = Object.entries(prediction);
  entries.sort((a, b) => b[1] - a[1]);
  return entries[0][0];
}

function updateStageStatistics(type) {
  const stage = analyzer.determineStage(state.rounds);
  
  // ØªØ­Ø¯ÙŠØ« ÙÙ‚Ø· Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  if (type === 'P') state.statistics[stage].P++;
  else if (type === 'B') state.statistics[stage].B++;
  else if (type === 'T') state.statistics[stage].T++;
}

function undoRound() {
  if (state.rounds.length === 0) return;
  
  const lastRound = state.rounds.pop();
  const stage = analyzer.determineStage(state.rounds);
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  if (lastRound === 'P') state.statistics[stage].P = Math.max(0, state.statistics[stage].P - 1);
  else if (lastRound === 'B') state.statistics[stage].B = Math.max(0, state.statistics[stage].B - 1);
  else if (lastRound === 'T') state.statistics[stage].T = Math.max(0, state.statistics[stage].T - 1);
  
  // Ø¥Ø²Ø§Ù„Ø© Ø¢Ø®Ø± ØªÙ†Ø¨Ø¤ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®
  if (state.predictionsHistory.length > 0) {
    state.predictionsHistory.pop();
  }
  
  updateAll();
  dataManager.save();
  showToast('â†©ï¸ ØªÙ… Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©');
}

function addQuickRounds() {
  // Ø¥Ø¶Ø§ÙØ© 5 Ø¬ÙˆÙ„Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (Ù„Ù„ØªØ¬Ø±Ø¨Ø©)
  const types = ['P', 'B', 'T'];
  for (let i = 0; i < 5; i++) {
    const randomType = types[Math.floor(Math.random() * types.length)];
    pushRound(randomType);
  }
  showToast('ğŸ² ØªÙ… Ø¥Ø¶Ø§ÙØ© 5 Ø¬ÙˆÙ„Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
}

function resetAll() {
  if (state.rounds.length === 0) return;
  
  if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
  
  state.rounds = [];
  state.statistics = {
    early: { P: 0, B: 0, T: 0, correct: 0, total: 0 },
    mid: { P: 0, B: 0, T: 0, correct: 0, total: 0 },
    late: { P: 0, B: 0, T: 0, correct: 0, total: 0 }
  };
  state.predictionsHistory = [];
  state.currentPrediction = null;
  
  updateAll();
  dataManager.save();
  showToast('ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†');
}

function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme');
  const newTheme = current === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', newTheme);
  el('themeToggle').textContent = newTheme === 'dark' ? 'ğŸŒš' : 'ğŸŒ•';
}

// ========== ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ==========

function updateAll() {
  updateStageInfo();
  updatePredictions();
  updateStatistics();
  updateBigRoad();
  updateMicroPatterns();
  updateDistribution();
  updateClosingPatterns();
  updateDataStats();
}

function updateStageInfo() {
  const total = state.rounds.length;
  state.stage = analyzer.determineStage(state.rounds);
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
  el('currentRound').textContent = total;
  el('tableStage').textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${getStageName(state.stage)}`;
  el('tableStage').className = `stage-indicator stage-${state.stage}`;
  
  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø­Ù„Ø©
  const stageNames = {
    early: 'Ù…Ø¨ÙƒØ±Ø© (1-20 Ø¬ÙˆÙ„Ø©)',
    mid: 'ÙˆØ³Ø·Ù‰ (21-50 Ø¬ÙˆÙ„Ø©)',
    late: 'Ù…ØªØ£Ø®Ø±Ø© (51-73 Ø¬ÙˆÙ„Ø©)',
    extended: 'Ù…Ù…ØªØ¯Ø© (+73 Ø¬ÙˆÙ„Ø©)'
  };
  
  el('stageInfo').textContent = stageNames[state.stage] || state.stage;
  
  // Ø²Ø®Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©
  const momentum = analyzer.calculateMomentum(state.rounds);
  state.tableMomentum = momentum;
  
  const momentumEl = el('momentumIndicator');
  if (momentumEl) {
    const icon = momentum === 'volatile' ? 'â†—ï¸' : momentum === 'calm' ? 'â†˜ï¸' : 'â¡ï¸';
    const text = momentum === 'volatile' ? 'Ù…ØªÙ‚Ù„Ø¨' : momentum === 'calm' ? 'Ù‡Ø§Ø¯Ø¦' : 'Ù…Ø³ØªÙ‚Ø±';
    const colorClass = momentum === 'volatile' ? 'momentum-up' : 
                      momentum === 'calm' ? 'momentum-down' : 'momentum-stable';
    
    momentumEl.innerHTML = `<span class="momentum-indicator ${colorClass}"></span> ${icon} ${text}`;
  }
}

function getStageName(stage) {
  const names = {
    early: 'Ù…Ø¨ÙƒØ±Ø©',
    mid: 'ÙˆØ³Ø·Ù‰',
    late: 'Ù…ØªØ£Ø®Ø±Ø©',
    extended: 'Ù…Ù…ØªØ¯Ø©'
  };
  return names[stage] || stage;
}

function updatePredictions() {
  if (state.rounds.length === 0) {
    // Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    ['P', 'B', 'T'].forEach(type => {
      el(`predPct${type}`).textContent = '0%';
      el(`confidence${type}`).style.width = '0%';
    });
    el('finalCard').textContent = 'â€”';
    el('predictionReason').textContent = 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„';
    el('stageRecommendation').textContent = 'Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª';
    el('predictionStrategy').textContent = 'Ù†Ø¸Ø§Ù… ØªØ­Ù„ÙŠÙ„ Ù…Ø±Ø­Ù„ÙŠ Ù„Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø©';
    return;
  }
  
  // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ø¨Ø¤
  const prediction = analyzer.predictByStage(state.rounds, state.stage);
  state.currentPrediction = prediction;
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø³Ø¨
  ['P', 'B', 'T'].forEach(type => {
    const value = prediction[type].toFixed(1);
    el(`predPct${type}`).textContent = `${value}%`;
    el(`confidence${type}`).style.width = `${prediction[type]}%`;
  });
  
  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØ§Ø¦Ø²
  const entries = Object.entries(prediction);
  entries.sort((a, b) => b[1] - a[1]);
  const winner = entries[0][0];
  const confidence = entries[0][1] - (entries[1] ? entries[1][1] : 0);
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
  const winnerNames = { P: 'Ù„Ø§Ø¹Ø¨', B: 'Ù…ØµØ±ÙÙŠ', T: 'ØªØ¹Ø§Ø¯Ù„' };
  el('finalCard').textContent = confidence > 15 ? winnerNames[winner] : 'â€”';
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¨Ø¨
  const reason = confidence > 15 
    ? `Ø«Ù‚Ø©: ${confidence.toFixed(1)}% - ${getPredictionReason(state.stage)}`
    : 'Ø«Ù‚Ø© ØºÙŠØ± ÙƒØ§ÙÙŠØ© Ù„Ù„ØªÙ†Ø¨Ø¤ Ø§Ù„Ø¯Ù‚ÙŠÙ‚';
  el('predictionReason').textContent = reason;
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØµÙŠØ©
  el('stageRecommendation').textContent = analyzer.getStageRecommendation(state.stage);
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„ØªÙ†Ø¨Ø¤
  const strategyNames = {
    early: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø¨ÙƒØ±Ø©',
    mid: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ†Ø§ÙˆØ¨ Ø§Ù„Ù…ØªÙˆØ³Ø·',
    late: 'ØªØ­Ù„ÙŠÙ„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø·Ø§ÙˆÙ„Ø©'
  };
  el('predictionStrategy').textContent = strategyNames[state.stage] || 'ØªØ­Ù„ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù…';
  
  // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø§ØªØ¬Ø§Ù‡
  updateTrendIndicators(prediction);
  
  // ØªØ­Ø¯ÙŠØ« Ø«Ù‚Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
  const systemConfidence = analyzer.calculateStageConfidence(state.rounds, state.stage);
  el('systemConfidence').textContent = `${systemConfidence.toFixed(0)}%`;
}

function getPredictionReason(stage) {
  const reasons = {
    early: 'Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©',
    mid: 'Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ†Ø§ÙˆØ¨',
    late: 'Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¥ØºÙ„Ø§Ù‚'
  };
  return reasons[stage] || 'Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù…';
}

function updateTrendIndicators(prediction) {
  // ØªØ¨Ø³ÙŠØ·: Ù…Ù‚Ø§Ø±Ù†Ø© Ù…Ø¹ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
  ['P', 'B', 'T'].forEach(type => {
    const trendEl = el(`predTrend${type}`);
    if (!trendEl) return;
    
    // ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø¨Ø³Ø·ØŒ Ù†Ø¹Ø±Ø¶ Ø§ØªØ¬Ø§Ù‡ Ø¨Ø³ÙŠØ·
    const value = prediction[type];
    if (value > 40) trendEl.textContent = 'â†‘';
    else if (value > 30) trendEl.textContent = 'â†’';
    else trendEl.textContent = 'â†“';
  });
}

function updateStatistics() {
  // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø±Ø§Ø­Ù„
  ['early', 'mid', 'late'].forEach(stage => {
    const stats = state.statistics[stage];
    const total = stats.P + stats.B + stats.T;
    
    el(`${stage}P`).textContent = stats.P;
    el(`${stage}B`).textContent = stats.B;
    el(`${stage}T`).textContent = stats.T;
    
    const accuracy = stats.total > 0 ? (stats.correct / stats.total) * 100 : 0;
    el(`${stage}Acc`).textContent = `${accuracy.toFixed(1)}%`;
  });
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
  const totalP = state.rounds.filter(r => r === 'P').length;
  const totalB = state.rounds.filter(r => r === 'B').length;
  const totalT = state.rounds.filter(r => r === 'T').length;
  
  el('totalDist').textContent = `${totalP}-${totalB}-${totalT}`;
  
  // Ø£Ø·ÙˆÙ„ Ø³Ù„Ø³Ù„Ø©
  const streaks = analyzer.findStreaks(state.rounds);
  const longestStreak = streaks.length > 0 ? Math.max(...streaks.map(s => s.length)) : 0;
  el('longestStreak').textContent = longestStreak;
  
  // Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†Ø§ÙˆØ¨
  const alternationRate = analyzer.calculateAlternationRate(state.rounds);
  el('alternationRate').textContent = `${(alternationRate * 100).toFixed(1)}%`;
}

function updateBigRoad() {
  const canvas = el('bigRoad');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  const size = 30;
  const cols = Math.floor(canvas.width / size);
  let x = 0, y = 0;
  
  for (let i = 0; i < state.rounds.length; i++) {
    const round = state.rounds[i];
    
    // Ù„ÙˆÙ† Ø§Ù„Ø¬ÙˆÙ„Ø©
    ctx.fillStyle = round === 'P' ? '#3a86ff' : round === 'B' ? '#ff006e' : '#38b000';
    ctx.fillRect(x * size, y * size, size - 2, size - 2);
    
    // Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆÙ„Ø©
    ctx.fillStyle = '#ffffff';
    ctx.font = 'bold 12px Inter';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText((i + 1).toString(), x * size + size/2, y * size + size/2);
    
    y++;
    if (y * size >= canvas.height) {
      y = 0;
      x++;
      if (x >= cols) break;
    }
  }
}

function updateMicroPatterns() {
  const container = el('microPatterns');
  if (!container) return;
  
  container.innerHTML = '';
  
  if (state.rounds.length < 3) {
    container.innerHTML = '<div class="muted small" style="grid-column: 1/-1; text-align: center;">Ø£Ø¯Ø®Ù„ 3 Ø¬ÙˆÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ù†Ù…Ø§Ø·</div>';
    return;
  }
  
  const patterns = analyzer.findMicroPatterns(state.rounds);
  const patternEntries = Object.entries(patterns)
    .filter(([_, data]) => data.total >= 2) // ÙÙ‚Ø· Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªÙŠ ØªÙƒØ±Ø±Øª Ù…Ø±ØªÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„
    .sort((a, b) => b[1].total - a[1].total)
    .slice(0, 8); // Ø£ÙˆÙ„ 8 Ø£Ù†Ù…Ø§Ø·
  
  if (patternEntries.length === 0) {
    container.innerHTML = '<div class="muted small" style="grid-column: 1/-1; text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ù…Ø§Ø· Ù…ØªÙƒØ±Ø±Ø© Ø¨Ø¹Ø¯</div>';
    return;
  }
  
  patternEntries.forEach(([pattern, data]) => {
    const div = document.createElement('div');
    div.className = 'micro-pattern';
    
    // ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø©
    const confidence = (Math.max(data.P, data.B, data.T) / data.total) * 100;
    if (confidence > 70) div.classList.add('high-confidence');
    else if (confidence > 50) div.classList.add('medium-confidence');
    
    // Ø§Ù„Ù†Ù…Ø·
    const patternDisplay = pattern.split('').map(char => {
      return char === 'P' ? 'ğŸ”µ' : char === 'B' ? 'ğŸ”´' : 'ğŸŸ¢';
    }).join('');
    
    // Ø§Ù„ØªØ§Ù„ÙŠ Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹
    let nextMost = 'P';
    if (data.B > data.P && data.B > data.T) nextMost = 'B';
    if (data.T > data.P && data.T > data.B) nextMost = 'T';
    
    div.innerHTML = `
      <div style="font-size: 12px; margin-bottom: 4px;">${patternDisplay}</div>
      <div style="font-size: 10px; color: var(--muted);">Ø§Ù„ØªØ§Ù„ÙŠ: ${nextMost === 'P' ? 'ğŸ”µ' : nextMost === 'B' ? 'ğŸ”´' : 'ğŸŸ¢'}</div>
      <div style="font-size: 9px;">${data.total} Ù…Ø±Ø©</div>
    `;
    
    container.appendChild(div);
  });
}

function updateDistribution() {
  const total = state.rounds.length;
  if (total === 0) {
    el('distPlayer').style.width = '0%';
    el('distBanker').style.width = '0%';
    el('distTie').style.width = '0%';
    return;
  }
  
  const pCount = state.rounds.filter(r => r === 'P').length;
  const bCount = state.rounds.filter(r => r === 'B').length;
  const tCount = state.rounds.filter(r => r === 'T').length;
  
  const pPercent = (pCount / total) * 100;
  const bPercent = (bCount / total) * 100;
  const tPercent = (tCount / total) * 100;
  
  el('distPlayer').style.width = `${pPercent}%`;
  el('distBanker').style.width = `${bPercent}%`;
  el('distTie').style.width = `${tPercent}%`;
}

function updateClosingPatterns() {
  const total = state.rounds.length;
  
  if (total < 5) {
    el('last10Pattern').textContent = 'â€”â€”â€”';
    el('closingPattern').textContent = 'â€”';
    el('closingAdvice').textContent = 'Ø§Ù„Ø·Ø§ÙˆÙ„Ø© ÙÙŠ Ø¨Ø¯Ø§ÙŠØªÙ‡Ø§ - Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬';
    return;
  }
  
  // Ø¢Ø®Ø± 10 Ø¬ÙˆÙ„Ø§Øª
  const last10 = state.rounds.slice(-10);
  const patternDisplay = last10.map(r => {
    return r === 'P' ? 'ğŸ”µ' : r === 'B' ? 'ğŸ”´' : 'ğŸŸ¢';
  }).join('');
  
  el('last10Pattern').textContent = patternDisplay;
  
  // ØªØ­Ù„ÙŠÙ„ Ù†Ù…Ø· Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
  const closingStrength = analyzer.analyzeClosingPatterns(last10);
  
  if (closingStrength > 0.5) {
    el('closingPattern').textContent = 'Ù†Ù…Ø· Ø¥ØºÙ„Ø§Ù‚ Ù‚ÙˆÙŠ âœ“';
    el('closingPattern').style.color = '#38b000';
    el('closingAdvice').textContent = 'Ù„ÙˆØ­Ø¸ Ù†Ù…Ø· Ø¥ØºÙ„Ø§Ù‚ Ù‚ÙˆÙŠ - Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ø³ØªÙ…Ø±Ø§Ø±Ù‡ Ø¹Ø§Ù„ÙŠØ©';
  } else if (closingStrength > 0.3) {
    el('closingPattern').textContent = 'Ù†Ù…Ø· Ø¥ØºÙ„Ø§Ù‚ Ù…ØªÙˆØ³Ø·';
    el('closingPattern').style.color = '#d4af37';
    el('closingAdvice').textContent = 'Ù‡Ù†Ø§Ùƒ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ù†Ù…Ø§Ø· - Ù„ÙƒÙ†Ù‡Ø§ Ù„ÙŠØ³Øª Ù‚ÙˆÙŠØ©';
  } else {
    el('closingPattern').textContent = 'Ø¨Ø¯ÙˆÙ† Ù†Ù…Ø· ÙˆØ§Ø¶Ø­';
    el('closingPattern').style.color = '#ff006e';
    el('closingAdvice').textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ù…Ø§Ø· Ø¥ØºÙ„Ø§Ù‚ ÙˆØ§Ø¶Ø­Ø© - ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø§Ù…';
  }
}

function updateDataStats() {
  const statsEl = document.getElementById('dataStats');
  if (statsEl) {
    const patternCount = Object.keys(analyzer.findMicroPatterns(state.rounds)).length;
    statsEl.textContent = `${state.rounds.length} Ø¬ÙˆÙ„Ø© â€¢ ${patternCount} Ù†Ù…Ø·`;
  }
}

// ========== ØªØ£Ø«ÙŠØ±Ø§Øª ÙˆØ¥Ø´Ø¹Ø§Ø±Ø§Øª ==========

function showRoundEffect(type) {
  const finalCard = el('finalCard');
  if (!finalCard) return;
  
  // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ ØªØ£Ø«ÙŠØ±Ø§Øª Ø³Ø§Ø¨Ù‚Ø©
  finalCard.classList.remove('win-effect', 'loss-effect');
  
  // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¬Ø¯ÙŠØ¯ Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø©
  setTimeout(() => {
    // ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ­Ø§Ø¯Ù‚ Ø§Ù„Ù…Ø¨Ø³Ø·ØŒ Ù†Ø¶ÙŠÙ ØªØ£Ø«ÙŠØ±Ø§Ù‹ Ø¨Ø³ÙŠØ·Ø§Ù‹
    finalCard.classList.add('win-effect');
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¦Ù‡
    setTimeout(() => {
      finalCard.classList.remove('win-effect');
    }, 500);
  }, 100);
}

function showToast(message, type = 'success') {
  // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„ØªÙˆØ³Øª
  const toast = document.createElement('div');
  toast.textContent = message;
  toast.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${type === 'error' ? '#ef4444' : '#10b981'};
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    animation: slideIn 0.3s ease-out;
    font-family: Inter, sans-serif;
  `;
  
  document.body.appendChild(toast);
  
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙˆØ³Øª Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
  setTimeout(() => {
    toast.style.animation = 'slideOut 0.3s ease-in';
    setTimeout(() => {
      if (toast.parentNode) {
        document.body.removeChild(toast);
      }
    }, 300);
  }, 3000);
}

// Ø¥Ø¶Ø§ÙØ© Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„ØªÙˆØ³Øª
const style = document.createElement('style');
style.textContent = `
@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
@keyframes slideOut {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100%); opacity: 0; }
}
`;
document.head.appendChild(style);

// ========== ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… ==========

window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
