<!DOCTYPE html>
<html lang="ar">
<head>
  <!-- ... (Ø¨Ù‚ÙŠØ© head ÙƒÙ…Ø§ Ù‡Ùˆ) ... -->
  <style>
    /* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø­Ø³Ù†Ø© */
    .trends-container {
      margin-top: 15px;
      padding: 15px;
      background: linear-gradient(135deg, rgba(0,0,0,0.3), rgba(0,0,0,0.2));
      border-radius: 12px;
      border-left: 4px solid gold;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    .trends-container h3 {
      margin-top: 0;
      color: gold;
      text-align: center;
    }
    
    .trend-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      margin: 5px 0;
      border-radius: 8px;
      background-color: rgba(255,255,255,0.05);
    }
    
    .trend-indicator {
      font-size: 1.3em;
      margin-left: 8px;
    }
    
    .trend-value {
      font-weight: bold;
    }
    
    .hot-streak {
      background: linear-gradient(90deg, rgba(255,87,34,0.1), rgba(255,87,34,0.3));
      animation: pulse-hot 1.5s infinite;
    }
    
    .cold-streak {
      background: linear-gradient(90deg, rgba(33,150,243,0.1), rgba(33,150,243,0.3));
      animation: pulse-cold 1.5s infinite;
    }
    
    @keyframes pulse-hot {
      0% { box-shadow: 0 0 0 0 rgba(255,87,34,0.4); }
      70% { box-shadow: 0 0 0 8px rgba(255,87,34,0); }
      100% { box-shadow: 0 0 0 0 rgba(255,87,34,0); }
    }
    
    @keyframes pulse-cold {
      0% { box-shadow: 0 0 0 0 rgba(33,150,243,0.4); }
      70% { box-shadow: 0 0 0 8px rgba(33,150,243,0); }
      100% { box-shadow: 0 0 0 0 rgba(33,150,243,0); }
    }
    
    .patterns-container {
      margin-top: 15px;
      padding: 10px;
      background-color: rgba(255,215,0,0.05);
      border-radius: 8px;
    }
    
    .pattern-badge {
      display: inline-block;
      padding: 5px 10px;
      margin: 3px;
      background-color: rgba(255,215,0,0.2);
      border-radius: 15px;
      font-size: 0.85em;
      cursor: help;
      position: relative;
      transition: all 0.2s;
    }
    
    .pattern-badge:hover {
      background-color: rgba(255,215,0,0.3);
      transform: translateY(-2px);
    }
    
    .pattern-tooltip {
      visibility: hidden;
      width: 200px;
      background-color: rgba(0,0,0,0.8);
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .pattern-badge:hover .pattern-tooltip {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <!-- ... (Ø¨Ù‚ÙŠØ© Ø§Ù„Ù‡ÙŠÙƒÙ„ ÙƒÙ…Ø§ Ù‡Ùˆ) ... -->
  
  <div class="ai-stats" id="aiStats"></div>
  
  <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù† -->
  <div class="trends-container" id="trendsContainer">
    <h3>ğŸ“ˆ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª ÙˆØ§Ù„Ø£Ù†Ù…Ø§Ø·</h3>
    <div id="trendsContent"></div>
  </div>
  
  <div class="ai-advice" id="aiAdvice"></div>
  
  <!-- ... (Ø¨Ù‚ÙŠØ© Ø§Ù„Ù‡ÙŠÙƒÙ„ ÙƒÙ…Ø§ Ù‡Ùˆ) ... -->

  <script>
    // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ ÙƒÙ…Ø§ Ù‡ÙŠ) ...

    // Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª
    function updateTrendsAndStreaks() {
      const lang = document.getElementById('langSelect').value;
      const isArabic = lang === 'ar-MA';
      
      if (history.length < 3) {
        document.getElementById('trendsContent').innerHTML = isArabic ? 
          `<div style="text-align:center;padding:10px;">â³ Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª...</div>` : 
          `<div style="text-align:center;padding:10px;">â³ Wait for more rounds to analyze trends...</div>`;
        return;
      }

      const lastSeven = history.slice(-7);
      const lastFourteen = history.length >= 14 ? history.slice(-14, -7) : [];
      
      const counts = { P: 0, B: 0, T: 0 };
      const prevCounts = { P: 0, B: 0, T: 0 };
      
      lastSeven.forEach(r => counts[r]++);
      lastFourteen.forEach(r => prevCounts[r]++);
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø³Ø¨ÙŠØ©
      const getTrend = (current, prev, total) => {
        const change = total > 0 ? ((current - prev) / total * 100) : 0;
        if (change > 15) return { icon: 'â–²â–²', class: 'trend-up', text: isArabic ? 'Ø§Ø±ØªÙØ§Ø¹ ÙƒØ¨ÙŠØ±' : 'Sharp rise' };
        if (change > 5) return { icon: 'â–²', class: 'trend-up', text: isArabic ? 'Ø§Ø±ØªÙØ§Ø¹' : 'Rising' };
        if (change < -15) return { icon: 'â–¼â–¼', class: 'trend-down', text: isArabic ? 'Ø§Ù†Ø®ÙØ§Ø¶ ÙƒØ¨ÙŠØ±' : 'Sharp drop' };
        if (change < -5) return { icon: 'â–¼', class: 'trend-down', text: isArabic ? 'Ø§Ù†Ø®ÙØ§Ø¶' : 'Dropping' };
        return { icon: 'â”', class: 'trend-neutral', text: isArabic ? 'Ù…Ø³ØªÙ‚Ø±' : 'Stable' };
      };
      
      const pTrend = getTrend(counts.P, prevCounts.P, lastSeven.length);
      const bTrend = getTrend(counts.B, prevCounts.B, lastSeven.length);
      const tTrend = getTrend(counts.T, prevCounts.T, lastSeven.length);
      
      // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ù„Ø§Ø³Ù„
      const hotThreshold = 0.7; // 70% Ø£Ùˆ Ø£ÙƒØ«Ø±
      const coldThreshold = 0.2; // 20% Ø£Ùˆ Ø£Ù‚Ù„
      
      const isHot = (type) => counts[type] / lastSeven.length >= hotThreshold;
      const isCold = (type) => counts[type] / lastSeven.length <= coldThreshold;
      
      // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
      const patterns = detectAdvancedPatterns(history.slice(-15));
      
      // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const trendsHTML = `
        <div style="margin-bottom: 15px;">
          <h4 style="margin-bottom: 10px;color:gold;">${isArabic ? 'Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø¢Ø®Ø± 7 Ø¬ÙˆÙ„Ø§Øª' : 'Last 7 Rounds Trends'}</h4>
          
          <div class="trend-item ${isHot('P') ? 'hot-streak' : ''} ${isCold('P') ? 'cold-streak' : ''}">
            <div>
              <span class="player-text">${isArabic ? 'Ù„Ø§Ø¹Ø¨' : 'Player'}</span>
              <span class="trend-value">${counts.P}/${lastSeven.length} (${Math.round(counts.P/lastSeven.length*100)}%)</span>
            </div>
            <div>
              <span class="trend-indicator ${pTrend.class}" title="${pTrend.text}">${pTrend.icon}</span>
              ${isHot('P') ? '<span class="streak-indicator hot-streak">HOT</span>' : ''}
              ${isCold('P') ? '<span class="streak-indicator cold-streak">COLD</span>' : ''}
            </div>
          </div>
          
          <div class="trend-item ${isHot('B') ? 'hot-streak' : ''} ${isCold('B') ? 'cold-streak' : ''}">
            <div>
              <span class="banker-text">${isArabic ? 'Ù…ØµØ±ÙÙŠ' : 'Banker'}</span>
              <span class="trend-value">${counts.B}/${lastSeven.length} (${Math.round(counts.B/lastSeven.length*100)}%)</span>
            </div>
            <div>
              <span class="trend-indicator ${bTrend.class}" title="${bTrend.text}">${bTrend.icon}</span>
              ${isHot('B') ? '<span class="streak-indicator hot-streak">HOT</span>' : ''}
              ${isCold('B') ? '<span class="streak-indicator cold-streak">COLD</span>' : ''}
            </div>
          </div>
          
          <div class="trend-item ${isHot('T') ? 'hot-streak' : ''} ${isCold('T') ? 'cold-streak' : ''}">
            <div>
              <span class="tie-text">${isArabic ? 'ØªØ¹Ø§Ø¯Ù„' : 'Tie'}</span>
              <span class="trend-value">${counts.T}/${lastSeven.length} (${Math.round(counts.T/lastSeven.length*100)}%)</span>
            </div>
            <div>
              <span class="trend-indicator ${tTrend.class}" title="${tTrend.text}">${tTrend.icon}</span>
              ${isHot('T') ? '<span class="streak-indicator hot-streak">HOT</span>' : ''}
              ${isCold('T') ? '<span class="streak-indicator cold-streak">COLD</span>' : ''}
            </div>
          </div>
        </div>
        
        ${patterns.length > 0 ? `
        <div class="patterns-container">
          <h4 style="margin-top:0;margin-bottom:10px;color:gold;">${isArabic ? 'Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…ÙƒØªØ´ÙØ©' : 'Detected Patterns'}</h4>
          ${patterns.map(p => `
            <div class="pattern-badge">
              ${p.pattern}
              <span class="pattern-tooltip">${p.description[lang] || p.description.en}</span>
            </div>
          `).join('')}
        </div>
        ` : ''}
      `;
      
      document.getElementById('trendsContent').innerHTML = trendsHTML;
    }

    // Ø¯Ø§Ù„Ø© Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ù†Ù…Ø§Ø·
    function detectAdvancedPatterns(recentHistory) {
      if (recentHistory.length < 5) return [];
      
      const patterns = [];
      const lastFive = recentHistory.slice(-5).join('');
      const lastTen = recentHistory.slice(-10).join('');
      
      // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
      const commonPatterns = [
        {
          pattern: 'P-B-P-B-P',
          match: 'PBPBP',
          description: {
            ar: 'Ù†Ù…Ø· ØªÙ†Ø§ÙˆØ¨ Ø¨ÙŠÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆØ§Ù„Ù…ØµØ±ÙÙŠ',
            en: 'Alternating Player-Banker pattern'
          },
          strength: 0.8
        },
        {
          pattern: '5P',
          match: 'PPPPP',
          description: {
            ar: '5 Ù†ØªØ§Ø¦Ø¬ Ù…ØªØªØ§Ù„ÙŠØ© Ù„Ù„Ø§Ø¹Ø¨',
            en: '5 consecutive Player results'
          },
          strength: 0.9
        },
        {
          pattern: '3T+',
          match: /TTT/g,
          description: {
            ar: '3 ØªØ¹Ø§Ø¯Ù„Ø§Øª Ù…ØªØªØ§Ù„ÙŠØ© Ø£Ùˆ Ø£ÙƒØ«Ø±',
            en: '3 or more consecutive Ties'
          },
          strength: 0.7
        },
        {
          pattern: 'P-P-B-B-P',
          match: 'PPBBP',
          description: {
            ar: 'Ù†Ù…Ø· Ù…Ø²Ø¯ÙˆØ¬ (Ù„Ø§Ø¹Ø¨-Ù„Ø§Ø¹Ø¨ Ø«Ù… Ù…ØµØ±ÙÙŠ-Ù…ØµØ±ÙÙŠ)',
            en: 'Double pattern (P-P then B-B)'
          },
          strength: 0.75
        }
      ];
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù†Ù…Ø§Ø·
      commonPatterns.forEach(p => {
        if (typeof p.match === 'string' && lastFive === p.match) {
          patterns.push(p);
        } else if (p.match instanceof RegExp && p.match.test(lastTen)) {
          patterns.push(p);
        }
      });
      
      // Ø§ÙƒØªØ´Ø§Ù Ø³Ù„Ø§Ø³Ù„ Ù‚ØµÙŠØ±Ø©
      const lastThree = recentHistory.slice(-3).join('');
      if (lastThree === 'PPP') {
        patterns.push({
          pattern: '3P',
          description: {
            ar: '3 Ù„Ø§Ø¹Ø¨ Ù…ØªØªØ§Ù„ÙŠØ©',
            en: '3 consecutive Player'
          },
          strength: 0.6
        });
      }
      if (lastThree === 'BBB') {
        patterns.push({
          pattern: '3B',
          description: {
            ar: '3 Ù…ØµØ±ÙÙŠ Ù…ØªØªØ§Ù„ÙŠØ©',
            en: '3 consecutive Banker'
          },
          strength: 0.6
        });
      }
      
      return patterns.sort((a, b) => b.strength - a.strength);
    }

    // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ ÙƒÙ…Ø§ Ù‡ÙŠ) ...
  </script>
</body>
</html>
