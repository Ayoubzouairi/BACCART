// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
let history = [];
let balance = 0;
let balanceHistory = [0];
let currentStreak = { type: null, count: 0 };
let betsHistory = [];
let showBetsHistory = false;
let lang = 'ar-MA';

// Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­
function calculateProfit(betOn, outcome, amount) {
  if (!amount || amount <= 0) return 0;
  
  if (betOn === outcome) {
    if (betOn === 'P') return amount * 1;
    if (betOn === 'B') return amount * 0.95;
    if (betOn === 'T') return amount * 8;
  } else if (outcome === 'T') {
    return 0;
  } else {
    return -amount;
  }
}

// Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯
function updateBalance(profit, betOn, outcome) {
  const balanceDisplay = document.getElementById('balanceDisplay');
  const balanceValue = document.getElementById('balanceValue');
  
  balance += profit;
  balanceHistory.push(balance);
  balanceValue.textContent = balance.toFixed(2);
  updateChart();
  
  if (profit > 0) {
    balanceDisplay.classList.add('balance-up');
    showNotification(
      lang === 'ar-MA' ? `Ø±Ø¨Ø­! +${profit.toFixed(2)} Ø¯Ø±Ù‡Ù…` : `Win! +${profit.toFixed(2)} MAD`,
      'win'
    );
  } else if (profit < 0) {
    balanceDisplay.classList.add('balance-down');
    showNotification(
      lang === 'ar-MA' ? `Ø®Ø³Ø§Ø±Ø©! ${profit.toFixed(2)} Ø¯Ø±Ù‡Ù…` : `Loss! ${profit.toFixed(2)} MAD`,
      'loss'
    );
  } else {
    showNotification(
      lang === 'ar-MA' ? 'ØªØ¹Ø§Ø¯Ù„ - Ù„Ø§ ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ø±ØµÙŠØ¯' : 'Tie - No change in balance',
      'tie'
    );
  }
  
  setTimeout(() => {
    balanceDisplay.classList.remove('balance-up', 'balance-down');
  }, 1000);
}

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
function showNotification(message, type) {
  const notification = document.createElement('div');
  notification.className = `notification notification-${type}`;
  notification.innerHTML = `${type === 'win' ? 'ğŸ‰' : type === 'loss' ? 'ğŸ’”' : 'ğŸ¤'} ${message}`;
  document.getElementById('notification-container').appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, 3000);
}

// Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù ...
// [ÙŠØ¬Ø¨ Ø£Ù† ØªØ¶Ø¹ Ù‡Ù†Ø§ ÙƒÙ„ Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ù Ø§Ù„Ù€ logic.js Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø§Ù„Ø°ÙŠ Ø£Ø¹Ø·ÙŠØªÙ‡ Ù„Ùƒ]

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
document.addEventListener('DOMContentLoaded', function() {
  loadTheme();
  loadLanguage();
  initChart();
  document.getElementById('langSelect').addEventListener('change', changeLanguage);
});
