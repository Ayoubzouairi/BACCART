// المتغيرات العامة
let history = [];
let balance = 0;
let balanceHistory = [0];
let currentStreak = { type: null, count: 0 };
let betsHistory = [];
let showBetsHistory = false;
let lang = 'ar-MA';

// دالة حساب الربح
function calculateProfit(betOn, outcome, amount) {
  if (!amount || amount <= 0) return 0;
  
  if (betOn === outcome) {
    if (betOn === 'P') return amount * 1;
    if (betOn === 'B') return amount * 0.95;
    if (betOn === 'T') return amount * 8;
  } else if (outcome === 'T') {
    return 0;
  } else {
    return -amount;
  }
}

// دالة تحديث الرصيد
function updateBalance(profit, betOn, outcome) {
  const balanceDisplay = document.getElementById('balanceDisplay');
  const balanceValue = document.getElementById('balanceValue');
  
  balance += profit;
  balanceHistory.push(balance);
  balanceValue.textContent = balance.toFixed(2);
  updateChart();
  
  if (profit > 0) {
    balanceDisplay.classList.add('balance-up');
    showNotification(
      lang === 'ar-MA' ? `ربح! +${profit.toFixed(2)} درهم` : `Win! +${profit.toFixed(2)} MAD`,
      'win'
    );
  } else if (profit < 0) {
    balanceDisplay.classList.add('balance-down');
    showNotification(
      lang === 'ar-MA' ? `خسارة! ${profit.toFixed(2)} درهم` : `Loss! ${profit.toFixed(2)} MAD`,
      'loss'
    );
  } else {
    showNotification(
      lang === 'ar-MA' ? 'تعادل - لا تغيير في الرصيد' : 'Tie - No change in balance',
      'tie'
    );
  }
  
  setTimeout(() => {
    balanceDisplay.classList.remove('balance-up', 'balance-down');
  }, 1000);
}

// دالة الإشعارات
function showNotification(message, type) {
  const notification = document.createElement('div');
  notification.className = `notification notification-${type}`;
  notification.innerHTML = `${type === 'win' ? '🎉' : type === 'loss' ? '💔' : '🤝'} ${message}`;
  document.getElementById('notification-container').appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, 3000);
}

// باقي الدوال والوظائف ...
// [يجب أن تضع هنا كل محتوى ملف الـ logic.js السابق الذي أعطيته لك]

// تهيئة التطبيق
document.addEventListener('DOMContentLoaded', function() {
  loadTheme();
  loadLanguage();
  initChart();
  document.getElementById('langSelect').addEventListener('change', changeLanguage);
});
